      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="perlxstypemap - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>perlxstypemap - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/perlxstypemap.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.32.0/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.32.0/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.32.0/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.32.0/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.32.0/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.32.0/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.32.0/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="index.html">Home</a>&nbsp; &gt;
    
      
        <a href="index-internals.html">Internals and C language interface</a> &gt;
      
    
    perlxstypemap
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 32.0
                        documentation</h7>
                    </div>
                    <h1>perlxstypemap</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><ul><li><a href="#Anatomy-of-a-typemap">Anatomy of a typemap</a></li><li><a href="#The-Role-of-the-typemap-File-in-Your-Distribution">The Role of the typemap File in Your Distribution</a></li><li><a href="#Sharing-typemaps-Between-CPAN-Distributions">Sharing typemaps Between CPAN Distributions</a></li><li><a href="#Writing-typemap-Entries">Writing typemap Entries</a></li><li><a href="#Full-Listing-of-Core-Typemaps">Full Listing of Core Typemaps</a></li></ul></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>perlxstypemap - Perl XS C/Perl type mapping</p>
<a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>The more you think about interfacing between two languages, the more
you'll realize that the majority of programmer effort has to go into
converting between the data structures that are native to either of
the languages involved.  This trumps other matter such as differing
calling conventions because the problem space is so much greater.
There are simply more ways to shove data into memory than there are
ways to implement a function call.</p>
<p>Perl XS' attempt at a solution to this is the concept of typemaps.
At an abstract level, a Perl XS typemap is nothing but a recipe for
converting from a certain Perl data structure to a certain C
data structure and vice versa.  Since there can be C types that
are sufficiently similar to one another to warrant converting with
the same logic, XS typemaps are represented by a unique identifier,
henceforth called an <strong>XS type</strong> in this document.  You can then tell
the XS compiler that multiple C types are to be mapped with the same
XS typemap.</p>
<p>In your XS code, when you define an argument with a C type or when
you are using a <code class="inline"><span class="j">CODE:</span></code>
 and an <code class="inline"><span class="j">OUTPUT:</span></code>
 section together with a
C return type of your XSUB, it'll be the typemapping mechanism that
makes this easy.</p>
<a class='view-head2' id="Anatomy-of-a-typemap"></a><h3 class='h3' >Anatomy of a typemap</h3>
<p>In more practical terms, the typemap is a collection of code
fragments which are used by the <strong>xsubpp</strong> compiler to map C function
parameters and values to Perl values.  The typemap file may consist
of three sections labelled <code class="inline"><span class="w">TYPEMAP</span></code>
, <code class="inline"><span class="w">INPUT</span></code>
, and <code class="inline"><span class="w">OUTPUT</span></code>
.
An unlabelled initial section is assumed to be a <code class="inline"><span class="w">TYPEMAP</span></code>
 section.
The INPUT section tells the compiler how to translate Perl values
into variables of certain C types.  The OUTPUT section tells the
compiler how to translate the values from certain C types into values
Perl can understand.  The TYPEMAP section tells the compiler which
of the INPUT and OUTPUT code fragments should be used to map a given
C type to a Perl value.  The section labels <code class="inline"><span class="w">TYPEMAP</span></code>
, <code class="inline"><span class="w">INPUT</span></code>
, or
<code class="inline"><span class="w">OUTPUT</span></code>
 must begin in the first column on a line by themselves,
and must be in uppercase.</p>
<p>Each type of section can appear an arbitrary number of times
and does not have to appear at all.  For example, a typemap may
commonly lack <code class="inline"><span class="w">INPUT</span></code>
 and <code class="inline"><span class="w">OUTPUT</span></code>
 sections if all it needs to
do is associate additional C types with core XS types like T_PTROBJ.
Lines that start with a hash <code class="inline"><span class="c">#</span></code>
 are considered comments and ignored
in the <code class="inline"><span class="w">TYPEMAP</span></code>
 section, but are considered significant in <code class="inline"><span class="w">INPUT</span></code>

and <code class="inline"><span class="w">OUTPUT</span></code>
. Blank lines are generally ignored.</p>
<p>Traditionally, typemaps needed to be written to a separate file,
conventionally called <code class="inline"><span class="w">typemap</span></code>
 in a CPAN distribution.  With
ExtUtils::ParseXS (the XS compiler) version 3.12 or better which
comes with perl 5.16, typemaps can also be embedded directly into
XS code using a HERE-doc like syntax:</p>
<pre class="verbatim"><ol><li>  <span class="j">TYPEMAP:</span> <span class="h">&lt;&lt;HERE</span></li><li><span class="hh">  ...</span></li><li><span class="hh">  HERE</span></li></ol></pre><p>where <code class="inline"><span class="w">HERE</span></code>
 can be replaced by other identifiers like with normal
Perl HERE-docs.  All details below about the typemap textual format
remain valid.</p>
<p>The <code class="inline"><span class="w">TYPEMAP</span></code>
 section should contain one pair of C type and
XS type per line as follows.  An example from the core typemap file:</p>
<pre class="verbatim"><ol><li>  <span class="w">TYPEMAP</span></li><li>  <span class="c"># all variants of char* is handled by the T_PV typemap</span></li><li>  <span class="w">char</span> *          <span class="w">T_PV</span></li><li>  <span class="w">const</span> <span class="w">char</span> *    <span class="w">T_PV</span></li><li>  <span class="w">unsigned</span> <span class="w">char</span> * <span class="w">T_PV</span></li><li>  ...</li></ol></pre><p>The <code class="inline"><span class="w">INPUT</span></code>
 and <code class="inline"><span class="w">OUTPUT</span></code>
 sections have identical formats, that is,
each unindented line starts a new in- or output map respectively.
A new in- or output map must start with the name of the XS type to
map on a line by itself, followed by the code that implements it
indented on the following lines. Example:</p>
<pre class="verbatim"><ol><li>  <span class="w">INPUT</span></li><li>  <span class="w">T_PV</span></li><li>    <span class="i">$var</span> = <span class="s">(</span><span class="i">$type</span><span class="s">)</span><span class="i">SvPV_nolen</span><span class="s">(</span><span class="i">$arg</span><span class="s">)</span></li><li>  <span class="w">T_PTR</span></li><li>    <span class="i">$var</span> = <span class="i">INT2PTR</span><span class="s">(</span><span class="i">$type</span><span class="cm">,</span><span class="i">SvIV</span><span class="s">(</span><span class="i">$arg</span><span class="s">)</span><span class="s">)</span></li></ol></pre><p>We'll get to the meaning of those Perlish-looking variables in a
little bit.</p>
<p>Finally, here's an example of the full typemap file for mapping C
strings of the <code class="inline"><span class="w">char</span> *</code>
 type to Perl scalars/strings:</p>
<pre class="verbatim"><ol><li>  <span class="w">TYPEMAP</span></li><li>  <span class="w">char</span> *  <span class="w">T_PV</span></li><li></li><li>  <span class="w">INPUT</span></li><li>  <span class="w">T_PV</span></li><li>    <span class="i">$var</span> = <span class="s">(</span><span class="i">$type</span><span class="s">)</span><span class="i">SvPV_nolen</span><span class="s">(</span><span class="i">$arg</span><span class="s">)</span></li><li></li><li>  <span class="w">OUTPUT</span></li><li>  <span class="w">T_PV</span></li><li>    <span class="i">sv_setpv</span><span class="s">(</span><span class="s">(</span><span class="w">SV</span>*<span class="s">)</span><span class="i">$arg</span><span class="cm">,</span> <span class="i">$var</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Here's a more complicated example: suppose that you wanted
<code class="inline"><span class="w">struct</span> <span class="w">netconfig</span></code>
 to be blessed into the class <code class="inline"><span class="w">Net::Config</span></code>
.
One way to do this is to use underscores (_) to separate package
names, as follows:</p>
<pre class="verbatim"><ol><li>  <span class="w">typedef</span> <span class="w">struct</span> <span class="w">netconfig</span> * <span class="w">Net_Config</span><span class="sc">;</span></li></ol></pre><p>And then provide a typemap entry <code class="inline"><span class="w">T_PTROBJ_SPECIAL</span></code>
 that maps
underscores to double-colons (::), and declare <code class="inline"><span class="w">Net_Config</span></code>
 to be of
that type:</p>
<pre class="verbatim"><ol><li>  <span class="w">TYPEMAP</span></li><li>  <span class="w">Net_Config</span>      <span class="w">T_PTROBJ_SPECIAL</span></li><li></li><li>  <span class="w">INPUT</span></li><li>  <span class="w">T_PTROBJ_SPECIAL</span></li><li>    <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span><span class="i">sv_derived_from</span><span class="s">(</span><span class="i">$arg</span><span class="cm">,</span> \<span class="q">&quot;${(my $ntt=$ntype)=~s/_/::/g;\$ntt}\&quot;)){</span></li><li>      <span class="q">      IV tmp = SvIV((SV*)SvRV($arg));</span></li><li>      <span class="q">      $var = INT2PTR($type, tmp);</span></li><li>    <span class="q">    }</span></li><li>    <span class="q">    else</span></li><li>      <span class="q">      croak(\&quot;$var is not of type ${(my $ntt=$ntype)=~s/_/::/g;\$ntt}\&quot;)</span></li><li></li><li>  <span class="q">  OUTPUT</span></li><li>  <span class="q">  T_PTROBJ_SPECIAL</span></li><li>    <span class="q">    sv_setref_pv($arg, \&quot;${(my $ntt=$ntype)=~s/_/::/g;\$ntt}\&quot;,</span></li><li>                 <span class="q">                 (void*)$var);</span></li></ol></pre><p>The INPUT and OUTPUT sections substitute underscores for double-colons
on the fly, giving the desired effect.  This example demonstrates some
of the power and versatility of the typemap facility.</p>
<p>The <code class="inline"><span class="w">INT2PTR</span></code>
 macro (defined in perl.h) casts an integer to a pointer
of a given type, taking care of the possible different size of integers
and pointers.  There are also <code class="inline"><span class="w">PTR2IV</span></code>
, <code class="inline"><span class="w">PTR2UV</span></code>
, <code class="inline"><span class="w">PTR2NV</span></code>
 macros,
to map the other way, which may be useful in OUTPUT sections.</p>
<a class='view-head2' id="The-Role-of-the-typemap-File-in-Your-Distribution"></a><h3 class='h3' >The Role of the typemap File in Your Distribution</h3>
<p>The default typemap in the <i>lib/ExtUtils</i> directory of the Perl source
contains many useful types which can be used by Perl extensions.  Some
extensions define additional typemaps which they keep in their own directory.
These additional typemaps may reference INPUT and OUTPUT maps in the main
typemap.  The <strong>xsubpp</strong> compiler will allow the extension's own typemap to
override any mappings which are in the default typemap.  Instead of using
an additional <i>typemap</i> file, typemaps may be embedded verbatim in XS
with a heredoc-like syntax.  See the documentation on the <code class="inline"><span class="j">TYPEMAP:</span></code>
 XS
keyword.</p>
<p>For CPAN distributions, you can assume that the XS types defined by
the perl core are already available. Additionally, the core typemap
has default XS types for a large number of C types.  For example, if
you simply return a <code class="inline"><span class="w">char</span> *</code>
 from your XSUB, the core typemap will
have this C type associated with the T_PV XS type.  That means your
C string will be copied into the PV (pointer value) slot of a new scalar
that will be returned from your XSUB to Perl.</p>
<p>If you're developing a CPAN distribution using XS, you may add your own
file called <i>typemap</i> to the distribution.  That file may contain
typemaps that either map types that are specific to your code or that
override the core typemap file's mappings for common C types.</p>
<a class='view-head2' id="Sharing-typemaps-Between-CPAN-Distributions"></a><h3 class='h3' >Sharing typemaps Between CPAN Distributions</h3>
<p>Starting with ExtUtils::ParseXS version 3.13_01 (comes with perl 5.16
and better), it is rather easy to share typemap code between multiple
CPAN distributions. The general idea is to share it as a module that
offers a certain API and have the dependent modules declare that as a
built-time requirement and import the typemap into the XS. An example
of such a typemap-sharing module on CPAN is
<code class="inline"><span class="w">ExtUtils::Typemaps::Basic</span></code>
. Two steps to getting that module's
typemaps available in your code:</p>
<ul>
<li>
<p>Declare <code class="inline"><span class="w">ExtUtils::Typemaps::Basic</span></code>
 as a build-time dependency
in <code class="inline"><span class="w">Makefile</span>.<span class="w">PL</span></code>
 (use <code class="inline"><span class="w">BUILD_REQUIRES</span></code>
), or in your <code class="inline"><span class="w">Build</span>.<span class="w">PL</span></code>

(use <code class="inline"><span class="w">build_requires</span></code>
).</p>
</li>
<li>
<p>Include the following line in the XS section of your XS file:
(don't break the line)</p>
<pre class="verbatim"><ol><li>  <span class="j">INCLUDE_COMMAND:</span> <span class="i">$^X</span> -<span class="w">MExtUtils::Typemaps::Cmd</span></li><li>                   -e <span class="q">&quot;print embeddable_typemap(q{Basic})&quot;</span></li></ol></pre></li>
</ul>
<a class='view-head2' id="Writing-typemap-Entries"></a><h3 class='h3' >Writing typemap Entries</h3>
<p>Each INPUT or OUTPUT typemap entry is a double-quoted Perl string that
will be evaluated in the presence of certain variables to get the
final C code for mapping a certain C type.</p>
<p>This means that you can embed Perl code in your typemap (C) code using
constructs such as
<code class="inline"><span class="i">$</span>{ <span class="w">perl</span> <span class="w">code</span> <span class="w">that</span> <span class="w">evaluates</span> <span class="w">to</span> <a class="l_k" href="functions/scalar.html">scalar</a> <span class="w">reference</span> <span class="w">here</span> }</code>
. A common
use case is to generate error messages that refer to the true function
name even when using the ALIAS XS feature:</p>
<pre class="verbatim"><ol><li>  <span class="i">$</span>{ <span class="i">$ALIAS</span> ? \<span class="q">q[GvNAME(CvGV(cv))]</span> <span class="co">:</span> \<span class="q">qq[\&quot;$pname\&quot;]</span> }</li></ol></pre><p>For many typemap examples, refer to the core typemap file that can be
found in the perl source tree at <i>lib/ExtUtils/typemap</i>.</p>
<p>The Perl variables that are available for interpolation into typemaps
are the following:</p>
<ul>
<li>
<p><i>$var</i> - the name of the input or output variable, eg. RETVAL for
return values.</p>
</li>
<li>
<p><i>$type</i> - the raw C type of the parameter, any <code class="inline"><span class="j">:</span></code>
 replaced with
<code class="inline"><span class="w">_</span></code>
.
e.g. for a type of <code class="inline"><span class="w">Foo::Bar</span></code>
, <i>$type</i> is <code class="inline"><span class="w">Foo__Bar</span></code>
</p>
</li>
<li>
<p><i>$ntype</i> - the supplied type with <code class="inline"><span class="i">*</span></code>
 replaced with <code class="inline"><span class="w">Ptr</span></code>
.
e.g. for a type of <code class="inline"><span class="w">Foo</span>*</code>
, <i>$ntype</i> is <code class="inline"><span class="w">FooPtr</span></code>
</p>
</li>
<li>
<p><i>$arg</i> - the stack entry, that the parameter is input from or output
to, e.g. <code class="inline"><span class="i">ST</span><span class="s">(</span><span class="n">0</span><span class="s">)</span></code>
</p>
</li>
<li>
<p><i>$argoff</i> - the argument stack offset of the argument.  ie. 0 for the
first argument, etc.</p>
</li>
<li>
<p><i>$pname</i> - the full name of the XSUB, with including the <code class="inline"><span class="w">PACKAGE</span></code>

name, with any <code class="inline"><span class="w">PREFIX</span></code>
 stripped.  This is the non-ALIAS name.</p>
</li>
<li>
<p><i>$Package</i> - the package specified by the most recent <code class="inline"><span class="w">PACKAGE</span></code>

keyword.</p>
</li>
<li>
<p><i>$ALIAS</i> - non-zero if the current XSUB has any aliases declared with
<code class="inline"><span class="w">ALIAS</span></code>
.</p>
</li>
</ul>
<a class='view-head2' id="Full-Listing-of-Core-Typemaps"></a><h3 class='h3' >Full Listing of Core Typemaps</h3>
<p>Each C type is represented by an entry in the typemap file that
is responsible for converting perl variables (SV, AV, HV, CV, etc.)
to and from that type. The following sections list all XS types
that come with perl by default.</p>
<ul>
<li><a class='view-title' id="T_SV"></a><strong>T_SV</strong>
<p>This simply passes the C representation of the Perl variable (an SV*)
in and out of the XS layer. This can be used if the C code wants
to deal directly with the Perl variable.</p>
</li>
<li><a class='view-title' id="T_SVREF"></a><strong>T_SVREF</strong>
<p>Used to pass in and return a reference to an SV.</p>
<p>Note that this typemap does not decrement the reference count
when returning the reference to an SV*.
See also: T_SVREF_REFCOUNT_FIXED</p>
</li>
<li><a class='view-title' id="T_SVREF_FIXED"></a><strong>T_SVREF_FIXED</strong>
<p>Used to pass in and return a reference to an SV.
This is a fixed
variant of T_SVREF that decrements the refcount appropriately
when returning a reference to an SV*. Introduced in perl 5.15.4.</p>
</li>
<li><a class='view-title' id="T_AVREF"></a><strong>T_AVREF</strong>
<p>From the perl level this is a reference to a perl array.
From the C level this is a pointer to an AV.</p>
<p>Note that this typemap does not decrement the reference count
when returning an AV*. See also: T_AVREF_REFCOUNT_FIXED</p>
</li>
<li><a class='view-title' id="T_AVREF_REFCOUNT_FIXED"></a><strong>T_AVREF_REFCOUNT_FIXED</strong>
<p>From the perl level this is a reference to a perl array.
From the C level this is a pointer to an AV. This is a fixed
variant of T_AVREF that decrements the refcount appropriately
when returning an AV*. Introduced in perl 5.15.4.</p>
</li>
<li><a class='view-title' id="T_HVREF"></a><strong>T_HVREF</strong>
<p>From the perl level this is a reference to a perl hash.
From the C level this is a pointer to an HV.</p>
<p>Note that this typemap does not decrement the reference count
when returning an HV*. See also: T_HVREF_REFCOUNT_FIXED</p>
</li>
<li><a class='view-title' id="T_HVREF_REFCOUNT_FIXED"></a><strong>T_HVREF_REFCOUNT_FIXED</strong>
<p>From the perl level this is a reference to a perl hash.
From the C level this is a pointer to an HV. This is a fixed
variant of T_HVREF that decrements the refcount appropriately
when returning an HV*. Introduced in perl 5.15.4.</p>
</li>
<li><a class='view-title' id="T_CVREF"></a><strong>T_CVREF</strong>
<p>From the perl level this is a reference to a perl subroutine
(e.g. $sub = sub { 1 };). From the C level this is a pointer
to a CV.</p>
<p>Note that this typemap does not decrement the reference count
when returning an HV*. See also: T_HVREF_REFCOUNT_FIXED</p>
</li>
<li><a class='view-title' id="T_CVREF_REFCOUNT_FIXED"></a><strong>T_CVREF_REFCOUNT_FIXED</strong>
<p>From the perl level this is a reference to a perl subroutine
(e.g. $sub = sub { 1 };). From the C level this is a pointer
to a CV.</p>
<p>This is a fixed
variant of T_HVREF that decrements the refcount appropriately
when returning an HV*. Introduced in perl 5.15.4.</p>
</li>
<li><a class='view-title' id="T_SYSRET"></a><strong>T_SYSRET</strong>
<p>The T_SYSRET typemap is used to process return values from system calls.
It is only meaningful when passing values from C to perl (there is
no concept of passing a system return value from Perl to C).</p>
<p>System calls return -1 on error (setting ERRNO with the reason)
and (usually) 0 on success. If the return value is -1 this typemap
returns <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code>. If the return value is not -1, this typemap
translates a 0 (perl false) to "0 but true" (which
is perl true) or returns the value itself, to indicate that the
command succeeded.</p>
<p>The <a href="POSIX.html">POSIX</a> module makes extensive use of this type.</p>
</li>
<li><a class='view-title' id="T_UV"></a><strong>T_UV</strong>
<p>An unsigned integer.</p>
</li>
<li><a class='view-title' id="T_IV"></a><strong>T_IV</strong>
<p>A signed integer. This is cast to the required integer type when
passed to C and converted to an IV when passed back to Perl.</p>
</li>
<li><a class='view-title' id="T_INT"></a><strong>T_INT</strong>
<p>A signed integer. This typemap converts the Perl value to a native
integer type (the <code class="inline"><a class="l_k" href="functions/int.html">int</a></code> type on the current platform). When returning
the value to perl it is processed in the same way as for T_IV.</p>
<p>Its behaviour is identical to using an <code class="inline"><a class="l_k" href="functions/int.html">int</a></code> type in XS with T_IV.</p>
</li>
<li><a class='view-title' id="T_ENUM"></a><strong>T_ENUM</strong>
<p>An enum value. Used to transfer an enum component
from C. There is no reason to pass an enum value to C since
it is stored as an IV inside perl.</p>
</li>
<li><a class='view-title' id="T_BOOL"></a><strong>T_BOOL</strong>
<p>A boolean type. This can be used to pass true and false values to and
from C.</p>
</li>
<li><a class='view-title' id="T_U_INT"></a><strong>T_U_INT</strong>
<p>This is for unsigned integers. It is equivalent to using T_UV
but explicitly casts the variable to type <code class="inline"><span class="w">unsigned</span> <a class="l_k" href="functions/int.html">int</a></code>
.
The default type for <code class="inline"><span class="w">unsigned</span> <a class="l_k" href="functions/int.html">int</a></code>
 is T_UV.</p>
</li>
<li><a class='view-title' id="T_SHORT"></a><strong>T_SHORT</strong>
<p>Short integers. This is equivalent to T_IV but explicitly casts
the return to type <code class="inline"><span class="w">short</span></code>
. The default typemap for <code class="inline"><span class="w">short</span></code>

is T_IV.</p>
</li>
<li><a class='view-title' id="T_U_SHORT"></a><strong>T_U_SHORT</strong>
<p>Unsigned short integers. This is equivalent to T_UV but explicitly
casts the return to type <code class="inline"><span class="w">unsigned</span> <span class="w">short</span></code>
. The default typemap for
<code class="inline"><span class="w">unsigned</span> <span class="w">short</span></code>
 is T_UV.</p>
<p>T_U_SHORT is used for type <code class="inline"><span class="w">U16</span></code>
 in the standard typemap.</p>
</li>
<li><a class='view-title' id="T_LONG"></a><strong>T_LONG</strong>
<p>Long integers. This is equivalent to T_IV but explicitly casts
the return to type <code class="inline"><span class="w">long</span></code>
. The default typemap for <code class="inline"><span class="w">long</span></code>

is T_IV.</p>
</li>
<li><a class='view-title' id="T_U_LONG"></a><strong>T_U_LONG</strong>
<p>Unsigned long integers. This is equivalent to T_UV but explicitly
casts the return to type <code class="inline"><span class="w">unsigned</span> <span class="w">long</span></code>
. The default typemap for
<code class="inline"><span class="w">unsigned</span> <span class="w">long</span></code>
 is T_UV.</p>
<p>T_U_LONG is used for type <code class="inline"><span class="w">U32</span></code>
 in the standard typemap.</p>
</li>
<li><a class='view-title' id="T_CHAR"></a><strong>T_CHAR</strong>
<p>Single 8-bit characters.</p>
</li>
<li><a class='view-title' id="T_U_CHAR"></a><strong>T_U_CHAR</strong>
<p>An unsigned byte.</p>
</li>
<li><a class='view-title' id="T_FLOAT"></a><strong>T_FLOAT</strong>
<p>A floating point number. This typemap guarantees to return a variable
cast to a <code class="inline"><span class="w">float</span></code>
.</p>
</li>
<li><a class='view-title' id="T_NV"></a><strong>T_NV</strong>
<p>A Perl floating point number. Similar to T_IV and T_UV in that the
return type is cast to the requested numeric type rather than
to a specific type.</p>
</li>
<li><a class='view-title' id="T_DOUBLE"></a><strong>T_DOUBLE</strong>
<p>A double precision floating point number. This typemap guarantees to
return a variable cast to a <code class="inline"><span class="w">double</span></code>
.</p>
</li>
<li><a class='view-title' id="T_PV"></a><strong>T_PV</strong>
<p>A string (char *).</p>
</li>
<li><a class='view-title' id="T_PTR"></a><strong>T_PTR</strong>
<p>A memory address (pointer). Typically associated with a <code class="inline"><span class="w">void</span> *</code>

type.</p>
</li>
<li><a class='view-title' id="T_PTRREF"></a><strong>T_PTRREF</strong>
<p>Similar to T_PTR except that the pointer is stored in a scalar and the
reference to that scalar is returned to the caller. This can be used
to hide the actual pointer value from the programmer since it is usually
not required directly from within perl.</p>
<p>The typemap checks that a scalar reference is passed from perl to XS.</p>
</li>
<li><a class='view-title' id="T_PTROBJ"></a><strong>T_PTROBJ</strong>
<p>Similar to T_PTRREF except that the reference is blessed into a class.
This allows the pointer to be used as an object. Most commonly used to
deal with C structs. The typemap checks that the perl object passed
into the XS routine is of the correct class (or part of a subclass).</p>
<p>The pointer is blessed into a class that is derived from the name
of type of the pointer but with all '*' in the name replaced with
'Ptr'.</p>
<p>For <code class="inline"><a class="l_k" href="functions/DESTROY.html">DESTROY</a></code> XSUBs only, a T_PTROBJ is optimized to a T_PTRREF. This means
the class check is skipped.</p>
</li>
<li><a class='view-title' id="T_REF_IV_REF"></a><strong>T_REF_IV_REF</strong>
<p>NOT YET</p>
</li>
<li><a class='view-title' id="T_REF_IV_PTR"></a><strong>T_REF_IV_PTR</strong>
<p>Similar to T_PTROBJ in that the pointer is blessed into a scalar object.
The difference is that when the object is passed back into XS it must be
of the correct type (inheritance is not supported) while T_PTROBJ supports
inheritance.</p>
<p>The pointer is blessed into a class that is derived from the name
of type of the pointer but with all '*' in the name replaced with
'Ptr'.</p>
<p>For <code class="inline"><a class="l_k" href="functions/DESTROY.html">DESTROY</a></code> XSUBs only, a T_REF_IV_PTR is optimized to a T_PTRREF. This
means the class check is skipped.</p>
</li>
<li><a class='view-title' id="T_PTRDESC"></a><strong>T_PTRDESC</strong>
<p>NOT YET</p>
</li>
<li><a class='view-title' id="T_REFREF"></a><strong>T_REFREF</strong>
<p>Similar to T_PTRREF, except the pointer stored in the referenced scalar
is dereferenced and copied to the output variable. This means that
T_REFREF is to T_PTRREF as T_OPAQUE is to T_OPAQUEPTR. All clear?</p>
<p>Only the INPUT part of this is implemented (Perl to XSUB) and there
are no known users in core or on CPAN.</p>
</li>
<li><a class='view-title' id="T_REFOBJ"></a><strong>T_REFOBJ</strong>
<p>Like T_REFREF, except it does strict type checking (inheritance is not
supported).</p>
<p>For <code class="inline"><a class="l_k" href="functions/DESTROY.html">DESTROY</a></code> XSUBs only, a T_REFOBJ is optimized to a T_REFREF. This means
the class check is skipped.</p>
</li>
<li><a class='view-title' id="T_OPAQUEPTR"></a><strong>T_OPAQUEPTR</strong>
<p>This can be used to store bytes in the string component of the
SV. Here the representation of the data is irrelevant to perl and the
bytes themselves are just stored in the SV. It is assumed that the C
variable is a pointer (the bytes are copied from that memory
location).  If the pointer is pointing to something that is
represented by 8 bytes then those 8 bytes are stored in the SV (and
length() will report a value of 8). This entry is similar to T_OPAQUE.</p>
<p>In principle the unpack() command can be used to convert the bytes
back to a number (if the underlying type is known to be a number).</p>
<p>This entry can be used to store a C structure (the number
of bytes to be copied is calculated using the C <code class="inline"><span class="w">sizeof</span></code>
 function)
and can be used as an alternative to T_PTRREF without having to worry
about a memory leak (since Perl will clean up the SV).</p>
</li>
<li><a class='view-title' id="T_OPAQUE"></a><strong>T_OPAQUE</strong>
<p>This can be used to store data from non-pointer types in the string
part of an SV. It is similar to T_OPAQUEPTR except that the
typemap retrieves the pointer directly rather than assuming it
is being supplied. For example, if an integer is imported into
Perl using T_OPAQUE rather than T_IV the underlying bytes representing
the integer will be stored in the SV but the actual integer value will
not be available. i.e. The data is opaque to perl.</p>
<p>The data may be retrieved using the <code class="inline"><a class="l_k" href="functions/unpack.html">unpack</a></code> function if the
underlying type of the byte stream is known.</p>
<p>T_OPAQUE supports input and output of simple types.
T_OPAQUEPTR can be used to pass these bytes back into C if a pointer
is acceptable.</p>
</li>
<li><a class='view-title' id="Implicit-array"></a><strong>Implicit array</strong>
<p>xsubpp supports a special syntax for returning
packed C arrays to perl. If the XS return type is given as</p>
<pre class="verbatim"><ol><li>  <span class="i">array</span><span class="s">(</span><span class="w">type</span><span class="cm">,</span> <span class="w">nelem</span><span class="s">)</span></li></ol></pre><p>xsubpp will copy the contents of <code class="inline"><span class="w">nelem</span> * <span class="i">sizeof</span><span class="s">(</span><span class="w">type</span><span class="s">)</span></code>
 bytes from
RETVAL to an SV and push it onto the stack. This is only really useful
if the number of items to be returned is known at compile time and you
don't mind having a string of bytes in your SV.  Use T_ARRAY to push a
variable number of arguments onto the return stack (they won't be
packed as a single string though).</p>
<p>This is similar to using T_OPAQUEPTR but can be used to process more
than one element.</p>
</li>
<li><a class='view-title' id="T_PACKED"></a><strong>T_PACKED</strong>
<p>Calls user-supplied functions for conversion. For <code class="inline"><span class="w">OUTPUT</span></code>

(XSUB to Perl), a function named <code class="inline"><span class="w">XS_pack_</span><span class="i">$ntype</span></code>
 is called
with the output Perl scalar and the C variable to convert from.
<code class="inline"><span class="i">$ntype</span></code>
 is the normalized C type that is to be mapped to
Perl. Normalized means that all <code class="inline"><span class="i">*</span></code>
 are replaced by the
string <code class="inline"><span class="w">Ptr</span></code>
. The return value of the function is ignored.</p>
<p>Conversely for <code class="inline"><span class="w">INPUT</span></code>
 (Perl to XSUB) mapping, the
function named <code class="inline"><span class="w">XS_unpack_</span><span class="i">$ntype</span></code>
 is called with the input Perl
scalar as argument and the return value is cast to the mapped
C type and assigned to the output C variable.</p>
<p>An example conversion function for a typemapped struct
<code class="inline"><span class="w">foo_t</span> *</code>
 might be:</p>
<pre class="verbatim"><ol><li>  <span class="w">static</span> <span class="w">void</span></li><li>  <span class="i">XS_pack_foo_tPtr</span><span class="s">(</span><span class="w">SV</span> *<span class="w">out</span><span class="cm">,</span> <span class="w">foo_t</span> *<span class="w">in</span><span class="s">)</span></li><li>  <span class="s">{</span></li><li>    <span class="w">dTHX</span><span class="sc">;</span> <span class="q">/* alas, signature does not include pTHX_ */</span></li><li>    <span class="w">HV</span>* <span class="w">hash</span> = <span class="i">newHV</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">hv_stores</span><span class="s">(</span><span class="w">hash</span><span class="cm">,</span> <span class="q">&quot;int_member&quot;</span><span class="cm">,</span> <span class="i">newSViv</span><span class="s">(</span><span class="w">in</span><span class="w">-&gt;int_member</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">hv_stores</span><span class="s">(</span><span class="w">hash</span><span class="cm">,</span> <span class="q">&quot;float_member&quot;</span><span class="cm">,</span> <span class="i">newSVnv</span><span class="s">(</span><span class="w">in</span><span class="w">-&gt;float_member</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="q">/* ... */</span></li><li></li><li>    /<span class="i">* mortalize</span> <span class="w">as</span> <span class="w">thy</span> <span class="w">stack</span> <span class="w">is</span> <a class="l_k" href="functions/not.html">not</a> <span class="w">refcounted</span> *<span class="q">/</span></li><li>    <span class="q">    sv_setsv(out, sv_2mortal(newRV_noinc((SV*)hash)));</span></li><li>  <span class="q">  }</span></li></ol></pre><p>The conversion from Perl to C is left as an exercise to the reader,
but the prototype would be:</p>
<pre class="verbatim"><ol><li>  <span class="w">static</span> <span class="w">foo_t</span> *</li><li>  <span class="i">XS_unpack_foo_tPtr</span><span class="s">(</span><span class="w">SV</span> *<span class="w">in</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Instead of an actual C function that has to fetch the thread context
using <code class="inline"><span class="w">dTHX</span></code>
, you can define macros of the same name and avoid the
overhead. Also, keep in mind to possibly free the memory allocated by
<code class="inline"><span class="w">XS_unpack_foo_tPtr</span></code>
.</p>
</li>
<li><a class='view-title' id="T_PACKEDARRAY"></a><strong>T_PACKEDARRAY</strong>
<p>T_PACKEDARRAY is similar to T_PACKED. In fact, the <code class="inline"><span class="w">INPUT</span></code>
 (Perl
to XSUB) typemap is identical, but the <code class="inline"><span class="w">OUTPUT</span></code>
 typemap passes
an additional argument to the <code class="inline"><span class="w">XS_pack_</span><span class="i">$ntype</span></code>
 function. This
third parameter indicates the number of elements in the output
so that the function can handle C arrays sanely. The variable
needs to be declared by the user and must have the name
<code class="inline"><span class="w">count_</span><span class="i">$ntype</span></code>
 where <code class="inline"><span class="i">$ntype</span></code>
 is the normalized C type name
as explained above. The signature of the function would be for
the example above and <code class="inline"><span class="w">foo_t</span> **</code>
:</p>
<pre class="verbatim"><ol><li>  <span class="w">static</span> <span class="w">void</span></li><li>  <span class="i">XS_pack_foo_tPtrPtr</span><span class="s">(</span><span class="w">SV</span> *<span class="w">out</span><span class="cm">,</span> <span class="w">foo_t</span> *<span class="w">in</span><span class="cm">,</span> <span class="w">UV</span> <span class="w">count_foo_tPtrPtr</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The type of the third parameter is arbitrary as far as the typemap
is concerned. It just has to be in line with the declared variable.</p>
<p>Of course, unless you know the number of elements in the
<code class="inline"><span class="w">sometype</span> **</code>
 C array, within your XSUB, the return value from
<code class="inline"><span class="w">foo_t</span> ** <span class="i">XS_unpack_foo_tPtrPtr</span><span class="s">(</span>...<span class="s">)</span></code>
 will be hard to decipher.
Since the details are all up to the XS author (the typemap user),
there are several solutions, none of which particularly elegant.
The most commonly seen solution has been to allocate memory for
N+1 pointers and assign <code class="inline"><span class="w">NULL</span></code>
 to the (N+1)th to facilitate
iteration.</p>
<p>Alternatively, using a customized typemap for your purposes in
the first place is probably preferable.</p>
</li>
<li><a class='view-title' id="T_DATAUNIT"></a><strong>T_DATAUNIT</strong>
<p>NOT YET</p>
</li>
<li><a class='view-title' id="T_CALLBACK"></a><strong>T_CALLBACK</strong>
<p>NOT YET</p>
</li>
<li><a class='view-title' id="T_ARRAY"></a><strong>T_ARRAY</strong>
<p>This is used to convert the perl argument list to a C array
and for pushing the contents of a C array onto the perl
argument stack.</p>
<p>The usual calling signature is</p>
<pre class="verbatim"><ol><li>  <span class="i">@out</span> = <span class="i">array_func</span><span class="s">(</span> <span class="i">@in</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Any number of arguments can occur in the list before the array but
the input and output arrays must be the last elements in the list.</p>
<p>When used to pass a perl list to C the XS writer must provide a
function (named after the array type but with 'Ptr' substituted for
'*') to allocate the memory required to hold the list. A pointer
should be returned. It is up to the XS writer to free the memory on
exit from the function. The variable <code class="inline"><span class="w">ix_</span><span class="i">$var</span></code>
 is set to the number
of elements in the new array.</p>
<p>When returning a C array to Perl the XS writer must provide an integer
variable called <code class="inline"><span class="w">size_</span><span class="i">$var</span></code>
 containing the number of elements in the
array. This is used to determine how many elements should be pushed
onto the return argument stack. This is not required on input since
Perl knows how many arguments are on the stack when the routine is
called. Ordinarily this variable would be called <code class="inline"><span class="w">size_RETVAL</span></code>
.</p>
<p>Additionally, the type of each element is determined from the type of
the array. If the array uses type <code class="inline"><span class="w">intArray</span> *</code>
 xsubpp will
automatically work out that it contains variables of type <code class="inline"><a class="l_k" href="functions/int.html">int</a></code> and
use that typemap entry to perform the copy of each element. All
pointer '*' and 'Array' tags are removed from the name to determine
the subtype.</p>
</li>
<li><a class='view-title' id="T_STDIO"></a><strong>T_STDIO</strong>
<p>This is used for passing perl filehandles to and from C using
<code class="inline"><span class="w">FILE</span> *</code>
 structures.</p>
</li>
<li><a class='view-title' id="T_INOUT"></a><strong>T_INOUT</strong>
<p>This is used for passing perl filehandles to and from C using
<code class="inline"><span class="w">PerlIO</span> *</code>
 structures. The file handle can used for reading and
writing. This corresponds to the <code class="inline">+&lt;</code>
 mode, see also T_IN
and T_OUT.</p>
<p>See <a href="perliol.html">perliol</a> for more information on the Perl IO abstraction
layer. Perl must have been built with <code class="inline">-<span class="w">Duseperlio</span></code>
.</p>
<p>There is no check to assert that the filehandle passed from Perl
to C was created with the right <code class="inline"><a class="l_k" href="functions/open.html">open()</a></code> mode.</p>
<p>Hint: The <a href="perlxstut.html">perlxstut</a> tutorial covers the T_INOUT, T_IN, and T_OUT
XS types nicely.</p>
</li>
<li><a class='view-title' id="T_IN"></a><strong>T_IN</strong>
<p>Same as T_INOUT, but the filehandle that is returned from C to Perl
can only be used for reading (mode <code class="inline">&lt;</code>
).</p>
</li>
<li><a class='view-title' id="T_OUT"></a><strong>T_OUT</strong>
<p>Same as T_INOUT, but the filehandle that is returned from C to Perl
is set to use the open mode <code class="inline">+&gt;</code>
.</p>
</li>
</ul>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><ul><li><a href="#Anatomy-of-a-typemap">Anatomy of a typemap</a></li><li><a href="#The-Role-of-the-typemap-File-in-Your-Distribution">The Role of the typemap File in Your Distribution</a></li><li><a href="#Sharing-typemaps-Between-CPAN-Distributions">Sharing typemaps Between CPAN Distributions</a></li><li><a href="#Writing-typemap-Entries">Writing typemap Entries</a></li><li><a href="#Full-Listing-of-Core-Typemaps">Full Listing of Core Typemaps</a></li></ul></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.32.0/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.32.0/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.32.0/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
