      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="threads::shared - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>threads::shared - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/threads/shared.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.30.0/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.30.0/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.30.0/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.30.0/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.30.0/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.30.0/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.30.0/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="../index.html">Home</a>&nbsp; &gt;
    
      
        <a href="../index-pragmas.html">Pragmas</a> &gt;
      
    
    threads::shared
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 30.0
                        documentation</h7>
                    </div>
                    <h1>threads::shared</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#VERSION">VERSION</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#EXPORT">EXPORT</a></li><li><a href="#FUNCTIONS">FUNCTIONS</a></li><li><a href="#OBJECTS">OBJECTS</a></li><li><a href="#NOTES">NOTES</a></li><li><a href="#WARNINGS">WARNINGS</a></li><li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li><li><a href="#AUTHOR">AUTHOR</a></li><li><a href="#LICENSE">LICENSE</a></li></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>threads::shared - Perl extension for sharing data structures between threads</p>
<a class='view-head1' id="VERSION"></a><h2 class='h2' >VERSION</h2>
<p>This document describes threads::shared version 1.60</p>
<a class='view-head1' id="SYNOPSIS"></a><h2 class='h2' >SYNOPSIS</h2>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/use.html">use</a> <span class="w">threads</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/use.html">use</a> <span class="w">threads::shared</span><span class="sc">;</span></li><li></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$var</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">%hsh</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">@ary</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$scalar</span><span class="cm">,</span> <span class="i">@array</span><span class="cm">,</span> <span class="i">%hash</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">$scalar</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">@array</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="i">$var</span> = <span class="i">$scalar_value</span><span class="sc">;</span></li><li>  <span class="i">$var</span> = <span class="i">$shared_ref_value</span><span class="sc">;</span></li><li>  <span class="i">$var</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="i">$non_shared_ref_value</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">$var</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="s">{</span><span class="q">&#39;foo&#39;</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw/foo bar baz/</span><span class="s">]</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="i">$hsh</span>{<span class="q">&#39;foo&#39;</span>} = <span class="i">$scalar_value</span><span class="sc">;</span></li><li>  <span class="i">$hsh</span>{<span class="q">&#39;bar&#39;</span>} = <span class="i">$shared_ref_value</span><span class="sc">;</span></li><li>  <span class="i">$hsh</span>{<span class="q">&#39;baz&#39;</span>} = <span class="i">shared_clone</span><span class="s">(</span><span class="i">$non_shared_ref_value</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">$hsh</span>{<span class="q">&#39;quz&#39;</span>} = <span class="i">shared_clone</span><span class="s">(</span><span class="s">[</span><span class="n">1</span>..<span class="n">3</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="i">$ary</span>[<span class="n">0</span>] = <span class="i">$scalar_value</span><span class="sc">;</span></li><li>  <span class="i">$ary</span>[<span class="n">1</span>] = <span class="i">$shared_ref_value</span><span class="sc">;</span></li><li>  <span class="i">$ary</span>[<span class="n">2</span>] = <span class="i">shared_clone</span><span class="s">(</span><span class="i">$non_shared_ref_value</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">$ary</span>[<span class="n">3</span>] = <span class="i">shared_clone</span><span class="s">(</span><span class="s">[</span> <span class="s">{</span><span class="s">}</span><span class="cm">,</span> <span class="s">[</span><span class="s">]</span> <span class="s">]</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="s">{</span> <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="sc">;</span> ...  <span class="s">}</span></li><li></li><li>  <span class="i">cond_wait</span><span class="s">(</span><span class="i">$scalar</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">cond_timedwait</span><span class="s">(</span><span class="i">$scalar</span><span class="cm">,</span> <a class="l_k" href="../functions/time.html">time</a><span class="s">(</span><span class="s">)</span> + <span class="n">30</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">cond_broadcast</span><span class="s">(</span><span class="i">@array</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">cond_signal</span><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$lockvar</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <span class="c"># condition var != lock var</span></li><li>  <span class="i">cond_wait</span><span class="s">(</span><span class="i">$var</span><span class="cm">,</span> <span class="i">$lockvar</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">cond_timedwait</span><span class="s">(</span><span class="i">$var</span><span class="cm">,</span> <a class="l_k" href="../functions/time.html">time</a><span class="s">(</span><span class="s">)</span>+<span class="n">30</span><span class="cm">,</span> <span class="i">$lockvar</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>By default, variables are private to each thread, and each newly created
thread gets a private copy of each existing variable.  This module allows you
to share variables across different threads (and pseudo-forks on Win32).  It
is used together with the <a href="../threads.html">threads</a> module.</p>
<p>This module supports the sharing of the following data types only:  scalars
and scalar refs, arrays and array refs, and hashes and hash refs.</p>
<a class='view-head1' id="EXPORT"></a><h2 class='h2' >EXPORT</h2>
<p>The following functions are exported by this module: <code class="inline"><span class="w">share</span></code>
,
<code class="inline"><span class="w">shared_clone</span></code>
, <code class="inline"><span class="w">is_shared</span></code>
, <code class="inline"><span class="w">cond_wait</span></code>
, <code class="inline"><span class="w">cond_timedwait</span></code>
, <code class="inline"><span class="w">cond_signal</span></code>

and <code class="inline"><span class="w">cond_broadcast</span></code>
</p>
<p>Note that if this module is imported when <a href="../threads.html">threads</a> has not yet been loaded,
then these functions all become no-ops.  This makes it possible to write
modules that will work in both threaded and non-threaded environments.</p>
<a class='view-head1' id="FUNCTIONS"></a><h2 class='h2' >FUNCTIONS</h2>
<ul>
<li><a class='view-title' id="share-VARIABLE"></a><strong>share VARIABLE</strong>
<p><code class="inline"><span class="w">share</span></code>
 takes a variable and marks it as shared:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$scalar</span><span class="cm">,</span> <span class="i">@array</span><span class="cm">,</span> <span class="i">%hash</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">$scalar</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">@array</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p><code class="inline"><span class="w">share</span></code>
 will return the shared rvalue, but always as a reference.</p>
<p>Variables can also be marked as shared at compile time by using the
<code class="inline"><span class="j">:</span><span class="w">shared</span></code>
 attribute:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$var</span><span class="cm">,</span> <span class="i">%hash</span><span class="cm">,</span> <span class="i">@array</span><span class="s">)</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li></ol></pre><p>Shared variables can only store scalars, refs of shared variables, or
refs of shared data (discussed in next section):</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$var</span><span class="cm">,</span> <span class="i">%hash</span><span class="cm">,</span> <span class="i">@array</span><span class="s">)</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$bork</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Storing scalars</span></li><li>  <span class="i">$var</span> = <span class="n">1</span><span class="sc">;</span></li><li>  <span class="i">$hash</span>{<span class="q">&#39;foo&#39;</span>} = <span class="q">&#39;bar&#39;</span><span class="sc">;</span></li><li>  <span class="i">$array</span>[<span class="n">0</span>] = <span class="n">1.5</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Storing shared refs</span></li><li>  <span class="i">$var</span> = \<span class="i">%hash</span><span class="sc">;</span></li><li>  <span class="i">$hash</span>{<span class="q">&#39;ary&#39;</span>} = \<span class="i">@array</span><span class="sc">;</span></li><li>  <span class="i">$array</span>[<span class="n">1</span>] = \<span class="i">$var</span><span class="sc">;</span></li><li></li><li>  <span class="c"># The following are errors:</span></li><li>  <span class="c">#   $var = \$bork;                    # ref of non-shared variable</span></li><li>  <span class="c">#   $hash{&#39;bork&#39;} = [];               # non-shared array ref</span></li><li>  <span class="c">#   push(@array, { &#39;x&#39; =&gt; 1 });       # non-shared hash ref</span></li></ol></pre></li>
<li><a class='view-title' id="shared_clone-REF"></a><strong>shared_clone REF</strong>
<p><code class="inline"><span class="w">shared_clone</span></code>
 takes a reference, and returns a shared version of its
argument, performing a deep copy on any non-shared elements.  Any shared
elements in the argument are used as is (i.e., they are not cloned).</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$cpy</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="s">{</span><span class="q">&#39;foo&#39;</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw/foo bar baz/</span><span class="s">]</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Object status (i.e., the class an object is blessed into) is also cloned.</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$obj</span> = <span class="s">{</span><span class="q">&#39;foo&#39;</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="q">qw/foo bar baz/</span><span class="s">]</span><span class="s">}</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="q">&#39;Foo&#39;</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$cpy</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="i">$obj</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><a class="l_k" href="../functions/ref.html">ref</a><span class="s">(</span><span class="i">$cpy</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="s">)</span><span class="sc">;</span>         <span class="c"># Outputs &#39;Foo&#39;</span></li></ol></pre><p>For cloning empty array or hash refs, the following may also be used:</p>
<pre class="verbatim"><ol><li>  <span class="i">$var</span> = <span class="i">&amp;share</span><span class="s">(</span><span class="s">[</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>   <span class="c"># Same as $var = shared_clone([]);</span></li><li>  <span class="i">$var</span> = <span class="i">&amp;share</span><span class="s">(</span><span class="s">{</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>   <span class="c"># Same as $var = shared_clone({});</span></li></ol></pre><p>Not all Perl data types can be cloned (e.g., globs, code refs).  By default,
<code class="inline"><span class="w">shared_clone</span></code>
 will <a href="../Carp.html">croak</a> if it encounters such items.  To change
this behaviour to a warning, then set the following:</p>
<pre class="verbatim"><ol><li>  <span class="i">$threads::shared::clone_warn</span> = <span class="n">1</span><span class="sc">;</span></li></ol></pre><p>In this case, <code class="inline"><a class="l_k" href="../functions/undef.html">undef</a></code> will be substituted for the item to be cloned.  If
set to zero:</p>
<pre class="verbatim"><ol><li>  <span class="i">$threads::shared::clone_warn</span> = <span class="n">0</span><span class="sc">;</span></li></ol></pre><p>then the <code class="inline"><a class="l_k" href="../functions/undef.html">undef</a></code> substitution will be performed silently.</p>
</li>
<li><a class='view-title' id="is_shared-VARIABLE"></a><strong>is_shared VARIABLE</strong>
<p><code class="inline"><span class="w">is_shared</span></code>
 checks if the specified variable is shared or not.  If shared,
returns the variable's internal ID (similar to
<code class="inline"><span class="i">refaddr</span><span class="s">(</span><span class="s">)</span></code>
 (see <a href="../Scalar/Util.html">Scalar::Util</a>).  Otherwise, returns <code class="inline"><a class="l_k" href="../functions/undef.html">undef</a></code>.</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/if.html">if</a> <span class="s">(</span><span class="i">is_shared</span><span class="s">(</span><span class="i">$var</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>      <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><span class="q">&quot;\$var is shared\n&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span> <a class="l_k" href="../functions/else.html">else</a> <span class="s">{</span></li><li>      <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><span class="q">&quot;\$var is not shared\n&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>When used on an element of an array or hash, <code class="inline"><span class="w">is_shared</span></code>
 checks if the
specified element belongs to a shared array or hash.  (It does not check
the contents of that element.)</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">%hash</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/if.html">if</a> <span class="s">(</span><span class="i">is_shared</span><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>      <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><span class="q">&quot;\%hash is shared\n&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li></li><li>  <span class="i">$hash</span>{<span class="q">&#39;elem&#39;</span>} = <span class="n">1</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/if.html">if</a> <span class="s">(</span><span class="i">is_shared</span><span class="s">(</span><span class="i">$hash</span>{<span class="q">&#39;elem&#39;</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>      <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><span class="q">&quot;\$hash{&#39;elem&#39;} is in a shared hash\n&quot;</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre></li>
<li><a class='view-title' id="lock-VARIABLE"></a><strong>lock VARIABLE</strong>
<p><code class="inline"><a class="l_k" href="../functions/lock.html">lock</a></code> places a <strong>advisory</strong> lock on a variable until the lock goes out of
scope.  If the variable is locked by another thread, the <code class="inline"><a class="l_k" href="../functions/lock.html">lock</a></code> call will
block until it's available.  Multiple calls to <code class="inline"><a class="l_k" href="../functions/lock.html">lock</a></code> by the same thread from
within dynamically nested scopes are safe -- the variable will remain locked
until the outermost lock on the variable goes out of scope.</p>
<p><code class="inline"><a class="l_k" href="../functions/lock.html">lock</a></code> follows references exactly <i>one</i> level:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">%hash</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ref</span> = \<span class="i">%hash</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">$ref</span><span class="s">)</span><span class="sc">;</span>           <span class="c"># This is equivalent to lock(%hash)</span></li></ol></pre><p>Note that you cannot explicitly unlock a variable; you can only wait for the
lock to go out of scope.  This is most easily accomplished by locking the
variable inside a block.</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$var</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <span class="s">{</span></li><li>      <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">$var</span><span class="s">)</span><span class="sc">;</span></li><li>      <span class="c"># $var is locked from here to the end of the block</span></li><li>      ...</li><li>  <span class="s">}</span></li><li>  <span class="c"># $var is now unlocked</span></li></ol></pre><p>As locks are advisory, they do not prevent data access or modification by
another thread that does not itself attempt to obtain a lock on the variable.</p>
<p>You cannot lock the individual elements of a container variable:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">%hash</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>  <span class="i">$hash</span>{<span class="q">&#39;foo&#39;</span>} = <span class="q">&#39;bar&#39;</span><span class="sc">;</span></li><li>  <span class="c">#lock($hash{&#39;foo&#39;});          # Error</span></li><li>  <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">%hash</span><span class="s">)</span><span class="sc">;</span>                  <span class="c"># Works</span></li></ol></pre><p>If you need more fine-grained control over shared variable access, see
<a href="../Thread/Semaphore.html">Thread::Semaphore</a>.</p>
</li>
<li><a class='view-title' id="cond_wait-VARIABLE"></a><strong>cond_wait VARIABLE</strong>
</li>
<li><a class='view-title' id="cond_wait-CONDVAR%2c-LOCKVAR"></a><strong>cond_wait CONDVAR, LOCKVAR</strong>
<p>The <code class="inline"><span class="w">cond_wait</span></code>
 function takes a <strong>locked</strong> variable as a parameter, unlocks
the variable, and blocks until another thread does a <code class="inline"><span class="w">cond_signal</span></code>
 or
<code class="inline"><span class="w">cond_broadcast</span></code>
 for that same locked variable.  The variable that
<code class="inline"><span class="w">cond_wait</span></code>
 blocked on is re-locked after the <code class="inline"><span class="w">cond_wait</span></code>
 is satisfied.  If
there are multiple threads <code class="inline"><span class="w">cond_wait</span></code>
ing on the same variable, all but one
will re-block waiting to reacquire the
lock on the variable.  (So if you're only
using <code class="inline"><span class="w">cond_wait</span></code>
 for synchronization, give up the lock as soon as possible).
The two actions of unlocking the variable and entering the blocked wait state
are atomic, the two actions of exiting from the blocked wait state and
re-locking the variable are not.</p>
<p>In its second form, <code class="inline"><span class="w">cond_wait</span></code>
 takes a shared, <strong>unlocked</strong> variable followed
by a shared, <strong>locked</strong> variable.  The second variable is unlocked and thread
execution suspended until another thread signals the first variable.</p>
<p>It is important to note that the variable can be notified even if no thread
<code class="inline"><span class="w">cond_signal</span></code>
 or <code class="inline"><span class="w">cond_broadcast</span></code>
 on the variable.  It is therefore
important to check the value of the variable and go back to waiting if the
requirement is not fulfilled.  For example, to pause until a shared counter
drops to zero:</p>
<pre class="verbatim"><ol><li>  <span class="s">{</span> <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">$counter</span><span class="s">)</span><span class="sc">;</span> <span class="i">cond_wait</span><span class="s">(</span><span class="i">$counter</span><span class="s">)</span> <a class="l_k" href="../functions/until.html">until</a> <span class="i">$counter</span> == <span class="n">0</span><span class="sc">;</span> <span class="s">}</span></li></ol></pre></li>
<li><a class='view-title' id="cond_timedwait-VARIABLE%2c-ABS_TIMEOUT"></a><strong>cond_timedwait VARIABLE, ABS_TIMEOUT</strong>
</li>
<li><a class='view-title' id="cond_timedwait-CONDVAR%2c-ABS_TIMEOUT%2c-LOCKVAR"></a><strong>cond_timedwait CONDVAR, ABS_TIMEOUT, LOCKVAR</strong>
<p>In its two-argument form, <code class="inline"><span class="w">cond_timedwait</span></code>
 takes a <strong>locked</strong> variable and an
absolute timeout in <i>epoch</i> seconds (see <a class='function-name' href="../functions/time.html">time</a>
for more) as parameters, unlocks the variable, and blocks until the
timeout is reached or another thread signals the variable.  A false value is
returned if the timeout is reached, and a true value otherwise.  In either
case, the variable is re-locked upon return.</p>
<p>Like <code class="inline"><span class="w">cond_wait</span></code>
, this function may take a shared, <strong>locked</strong> variable as an
additional parameter; in this case the first parameter is an <strong>unlocked</strong>
condition variable protected by a distinct lock variable.</p>
<p>Again like <code class="inline"><span class="w">cond_wait</span></code>
, waking up and reacquiring the lock are not atomic,
and you should always check your desired condition after this function
returns.  Since the timeout is an absolute value, however, it does not have to
be recalculated with each pass:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/lock.html">lock</a><span class="s">(</span><span class="i">$var</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$abs</span> = <a class="l_k" href="../functions/time.html">time</a><span class="s">(</span><span class="s">)</span> + <span class="n">15</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/until.html">until</a> <span class="s">(</span><span class="i">$ok</span> = <span class="i">desired_condition</span><span class="s">(</span><span class="i">$var</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>      <a class="l_k" href="../functions/last.html">last</a> <a class="l_k" href="../functions/if.html">if</a> !<span class="i">cond_timedwait</span><span class="s">(</span><span class="i">$var</span><span class="cm">,</span> <span class="i">$abs</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <span class="c"># we got it if $ok, otherwise we timed out!</span></li></ol></pre></li>
<li><a class='view-title' id="cond_signal-VARIABLE"></a><strong>cond_signal VARIABLE</strong>
<p>The <code class="inline"><span class="w">cond_signal</span></code>
 function takes a <strong>locked</strong> variable as a parameter and
unblocks one thread that's <code class="inline"><span class="w">cond_wait</span></code>
ing
on that variable.  If more than one
thread is blocked in a <code class="inline"><span class="w">cond_wait</span></code>
 on that variable, only one (and which one
is indeterminate) will be unblocked.</p>
<p>If there are no threads blocked in a <code class="inline"><span class="w">cond_wait</span></code>
 on the variable, the signal
is discarded.  By always locking before
signaling, you can (with care), avoid
signaling before another thread has entered cond_wait().</p>
<p><code class="inline"><span class="w">cond_signal</span></code>
 will normally generate a warning if you attempt to use it on an
unlocked variable.  On the rare occasions
where doing this may be sensible, you
can suppress the warning with:</p>
<pre class="verbatim"><ol><li>  <span class="s">{</span> <a class="l_k" href="../functions/no.html">no</a> <span class="w">warnings</span> <span class="q">&#39;threads&#39;</span><span class="sc">;</span> <span class="i">cond_signal</span><span class="s">(</span><span class="i">$foo</span><span class="s">)</span><span class="sc">;</span> <span class="s">}</span></li></ol></pre></li>
<li><a class='view-title' id="cond_broadcast-VARIABLE"></a><strong>cond_broadcast VARIABLE</strong>
<p>The <code class="inline"><span class="w">cond_broadcast</span></code>
 function works similarly to <code class="inline"><span class="w">cond_signal</span></code>
.
<code class="inline"><span class="w">cond_broadcast</span></code>
, though, will unblock <strong>all</strong> the threads that are blocked in
a <code class="inline"><span class="w">cond_wait</span></code>
 on the locked variable, rather than only one.</p>
</li>
</ul>
<a class='view-head1' id="OBJECTS"></a><h2 class='h2' >OBJECTS</h2>
<p><a href="../threads/shared.html">threads::shared</a> exports a version of <a class='function-name' href="../functions/bless.html">bless REF</a> that
works on shared objects such that <i>blessings</i> propagate across threads.</p>
<pre class="verbatim"><ol><li>  <span class="c"># Create a shared &#39;Foo&#39; object</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$foo</span> <span class="co">:</span><span class="w">shared</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="s">{</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$foo</span><span class="cm">,</span> <span class="q">&#39;Foo&#39;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Create a shared &#39;Bar&#39; object</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$bar</span> <span class="co">:</span><span class="w">shared</span> = <span class="i">shared_clone</span><span class="s">(</span><span class="s">{</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$bar</span><span class="cm">,</span> <span class="q">&#39;Bar&#39;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Put &#39;bar&#39; inside &#39;foo&#39;</span></li><li>  <span class="i">$foo</span>-&gt;{<span class="q">&#39;bar&#39;</span>} = <span class="i">$bar</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Rebless the objects via a thread</span></li><li>  <span class="w">threads</span><span class="w">-&gt;create</span><span class="s">(</span><a class="l_k" href="../functions/sub.html">sub</a> <span class="s">{</span></li><li>      <span class="c"># Rebless the outer object</span></li><li>      <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$foo</span><span class="cm">,</span> <span class="q">&#39;Yin&#39;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>      <span class="c"># Cannot directly rebless the inner object</span></li><li>      <span class="c">#bless($foo-&gt;{&#39;bar&#39;}, &#39;Yang&#39;);</span></li><li></li><li>      <span class="c"># Retrieve and rebless the inner object</span></li><li>      <a class="l_k" href="../functions/my.html">my</a> <span class="i">$obj</span> = <span class="i">$foo</span>-&gt;{<span class="q">&#39;bar&#39;</span>}<span class="sc">;</span></li><li>      <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="q">&#39;Yang&#39;</span><span class="s">)</span><span class="sc">;</span></li><li>      <span class="i">$foo</span>-&gt;{<span class="q">&#39;bar&#39;</span>} = <span class="i">$obj</span><span class="sc">;</span></li><li></li><li>  <span class="s">}</span><span class="s">)</span><span class="i">-&gt;join</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><a class="l_k" href="../functions/ref.html">ref</a><span class="s">(</span><span class="i">$foo</span><span class="s">)</span><span class="cm">,</span>          <span class="q">&quot;\n&quot;</span><span class="s">)</span><span class="sc">;</span>    <span class="c"># Prints &#39;Yin&#39;</span></li><li>  <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><a class="l_k" href="../functions/ref.html">ref</a><span class="s">(</span><span class="i">$foo</span>-&gt;{<span class="q">&#39;bar&#39;</span>}<span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="s">)</span><span class="sc">;</span>    <span class="c"># Prints &#39;Yang&#39;</span></li><li>  <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><a class="l_k" href="../functions/ref.html">ref</a><span class="s">(</span><span class="i">$bar</span><span class="s">)</span><span class="cm">,</span>          <span class="q">&quot;\n&quot;</span><span class="s">)</span><span class="sc">;</span>    <span class="c"># Also prints &#39;Yang&#39;</span></li></ol></pre><a class='view-head1' id="NOTES"></a><h2 class='h2' >NOTES</h2>
<p><a href="../threads/shared.html">threads::shared</a> is designed to disable itself silently if threads are not
available.  This allows you to write modules and packages that can be used
in both threaded and non-threaded applications.</p>
<p>If you want access to threads, you must <code class="inline"><a class="l_k" href="../functions/use.html">use</a> <span class="w">threads</span></code>
 before you
<code class="inline"><a class="l_k" href="../functions/use.html">use</a> <span class="w">threads::shared</span></code>
.  <a href="../threads.html">threads</a> will emit a warning if you use it after
<a href="../threads/shared.html">threads::shared</a>.</p>
<a class='view-head1' id="WARNINGS"></a><h2 class='h2' >WARNINGS</h2>
<ul>
<li><a class='view-title' id="cond_broadcast()-called-on-unlocked-variable"></a><strong>cond_broadcast() called on unlocked variable</strong>
</li>
<li><a class='view-title' id="cond_signal()-called-on-unlocked-variable"></a><strong>cond_signal() called on unlocked variable</strong>
<p>See <a href="#cond_signal-VARIABLE">cond_signal VARIABLE</a>, above.</p>
</li>
</ul>
<a class='view-head1' id="BUGS-AND-LIMITATIONS"></a><h2 class='h2' >BUGS AND LIMITATIONS</h2>
<p>When <code class="inline"><span class="w">share</span></code>
 is used on arrays, hashes, array refs or hash refs, any data
they contain will be lost.</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">@arr</span> = <span class="q">qw(foo bar baz)</span><span class="sc">;</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">@arr</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="c"># @arr is now empty (i.e., == ());</span></li><li></li><li>  <span class="c"># Create a &#39;foo&#39; object</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$foo</span> = <span class="s">{</span> <span class="q">&#39;data&#39;</span> <span class="cm">=&gt;</span> <span class="n">99</span> <span class="s">}</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$foo</span><span class="cm">,</span> <span class="q">&#39;foo&#39;</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="c"># Share the object</span></li><li>  <span class="i">share</span><span class="s">(</span><span class="i">$foo</span><span class="s">)</span><span class="sc">;</span>        <span class="c"># Contents are now wiped out</span></li><li>  <a class="l_k" href="../functions/print.html">print</a><span class="s">(</span><span class="q">&quot;ERROR: \$foo is empty\n&quot;</span><span class="s">)</span></li><li>      <a class="l_k" href="../functions/if.html">if</a> <span class="s">(</span>! <a class="l_k" href="../functions/exists.html">exists</a><span class="s">(</span><span class="i">$foo</span>-&gt;{<span class="q">&#39;data&#39;</span>}<span class="s">)</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Therefore, populate such variables <strong>after</strong> declaring them as shared.  (Scalar
and scalar refs are not affected by this problem.)</p>
<p>Blessing a shared item after it has been nested in another shared item does
not propagate the blessing to the shared reference:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$foo</span> = <span class="i">&amp;share</span><span class="s">(</span><span class="s">{</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/my.html">my</a> <span class="i">$bar</span> = <span class="i">&amp;share</span><span class="s">(</span><span class="s">{</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">$bar</span>-&gt;{<span class="w">foo</span>} = <span class="i">$foo</span><span class="sc">;</span></li><li>  <a class="l_k" href="../functions/bless.html">bless</a><span class="s">(</span><span class="i">$foo</span><span class="cm">,</span> <span class="q">&#39;baz&#39;</span><span class="s">)</span><span class="sc">;</span>   <span class="c"># $foo is now of class &#39;baz&#39;,</span></li><li>                        <span class="c"># but $bar-&gt;{foo} is unblessed.</span></li></ol></pre><p>Therefore, you should bless objects before sharing them.</p>
<p>It is often not wise to share an object unless the class itself has been
written to support sharing.  For example, a shared object's destructor may
get called multiple times, once for each thread's scope exit, or may not
get called at all if it is embedded inside another shared object.  Another
issue is that the contents of hash-based objects will be lost due to the
above mentioned limitation.  See <i>examples/class.pl</i> (in the CPAN
distribution of this module) for how to create a class that supports object
sharing.</p>
<p>Destructors may not be called on objects if those objects still exist at
global destruction time.  If the destructors must be called, make sure
there are no circular references and that nothing is referencing the
objects before the program ends.</p>
<p>Does not support <code class="inline"><a class="l_k" href="../functions/splice.html">splice</a></code> on arrays.  Does not support explicitly changing
array lengths via $#array -- use <code class="inline"><a class="l_k" href="../functions/push.html">push</a></code> and <code class="inline"><a class="l_k" href="../functions/pop.html">pop</a></code> instead.</p>
<p>Taking references to the elements of shared arrays and hashes does not
autovivify the elements, and neither does slicing a shared array/hash over
non-existent indices/keys autovivify the elements.</p>
<p><code class="inline"><span class="i">share</span><span class="s">(</span><span class="s">)</span></code>
 allows you to <code class="inline"><span class="i">share</span><span class="s">(</span><span class="i">$hashref</span>-&gt;{<span class="w">key</span>}<span class="s">)</span></code>
 and
<code class="inline"><span class="i">share</span><span class="s">(</span><span class="i">$arrayref</span>-&gt;[<span class="w">idx</span>]<span class="s">)</span></code>
 without giving any error message.  But the
<code class="inline"><span class="i">$hashref</span>-&gt;{<span class="w">key</span>}</code>
 or <code class="inline"><span class="i">$arrayref</span>-&gt;[<span class="w">idx</span>]</code>
 is <strong>not</strong> shared, causing
the error "lock can only be used on shared values" to occur when you attempt
to <code class="inline"><a class="l_k" href="../functions/lock.html">lock($hashref->{key})</a></code> or <code class="inline"><a class="l_k" href="../functions/lock.html">lock($arrayref->[idx])</a></code> in another
thread.</p>
<p>Using <code class="inline"><span class="i">refaddr</span><span class="s">(</span><span class="s">)</span></code>
 is unreliable for testing
whether or not two shared references are equivalent (e.g., when testing for
circular references).  Use <a href="#is_shared-VARIABLE">is_shared()</a>, instead:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">threads</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">threads::shared</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/use.html">use</a> <span class="w">Scalar::Util</span> <span class="q">qw(refaddr)</span><span class="sc">;</span></li><li></li><li>    <span class="c"># If ref is shared, use threads::shared&#39;s internal ID.</span></li><li>    <span class="c"># Otherwise, use refaddr().</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$addr1</span> = <span class="i">is_shared</span><span class="s">(</span><span class="i">$ref1</span><span class="s">)</span> || <span class="i">refaddr</span><span class="s">(</span><span class="i">$ref1</span><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$addr2</span> = <span class="i">is_shared</span><span class="s">(</span><span class="i">$ref2</span><span class="s">)</span> || <span class="i">refaddr</span><span class="s">(</span><span class="i">$ref2</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/if.html">if</a> <span class="s">(</span><span class="i">$addr1</span> == <span class="i">$addr2</span><span class="s">)</span> <span class="s">{</span></li><li>        <span class="c"># The refs are equivalent</span></li><li>    <span class="s">}</span></li></ol></pre><p><a class='function-name' href="../functions/each.html">each HASH</a> does not work properly on shared references
embedded in shared structures.  For example:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">%foo</span> <span class="co">:</span><span class="w">shared</span><span class="sc">;</span></li><li>    <span class="i">$foo</span>{<span class="q">&#39;bar&#39;</span>} = <span class="i">shared_clone</span><span class="s">(</span><span class="s">{</span><span class="q">&#39;a&#39;</span><span class="cm">=&gt;</span><span class="q">&#39;x&#39;</span><span class="cm">,</span> <span class="q">&#39;b&#39;</span><span class="cm">=&gt;</span><span class="q">&#39;y&#39;</span><span class="cm">,</span> <span class="q">&#39;c&#39;</span><span class="cm">=&gt;</span><span class="q">&#39;z&#39;</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="../functions/while.html">while</a> <span class="s">(</span><a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$key</span><span class="cm">,</span> <span class="i">$val</span><span class="s">)</span> = <a class="l_k" href="../functions/each.html">each</a><span class="s">(</span><span class="i">%</span>{<span class="i">$foo</span>{<span class="q">&#39;bar&#39;</span>}}<span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>        ...</li><li>    <span class="s">}</span></li></ol></pre><p>Either of the following will work instead:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$ref</span> = <span class="i">$foo</span>{<span class="q">&#39;bar&#39;</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="../functions/while.html">while</a> <span class="s">(</span><a class="l_k" href="../functions/my.html">my</a> <span class="s">(</span><span class="i">$key</span><span class="cm">,</span> <span class="i">$val</span><span class="s">)</span> = <a class="l_k" href="../functions/each.html">each</a><span class="s">(</span><span class="i">%</span>{<span class="i">$ref</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>        ...</li><li>    <span class="s">}</span></li><li></li><li>    <a class="l_k" href="../functions/foreach.html">foreach</a> <a class="l_k" href="../functions/my.html">my</a> <span class="i">$key</span> <span class="s">(</span><a class="l_k" href="../functions/keys.html">keys</a><span class="s">(</span><span class="i">%</span>{<span class="i">$foo</span>{<span class="q">&#39;bar&#39;</span>}}<span class="s">)</span><span class="s">)</span> <span class="s">{</span></li><li>        <a class="l_k" href="../functions/my.html">my</a> <span class="i">$val</span> = <span class="i">$foo</span>{<span class="q">&#39;bar&#39;</span>}{<span class="i">$key</span>}<span class="sc">;</span></li><li>        ...</li><li>    <span class="s">}</span></li></ol></pre><p>This module supports dual-valued variables created using <code class="inline"><span class="i">dualvar</span><span class="s">(</span><span class="s">)</span></code>
 from
<a href="../Scalar/Util.html">Scalar::Util</a>.  However, while <code class="inline"><span class="i">$!</span></code>
 acts
like a dualvar, it is implemented as a tied SV.  To propagate its value, use
the follow construct, if needed:</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="../functions/my.html">my</a> <span class="i">$errno</span> <span class="co">:</span><span class="w">shared</span> = <span class="i">dualvar</span><span class="s">(</span><span class="i">$!</span><span class="cm">,</span><span class="i">$!</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>View existing bug reports at, and submit any new bugs, problems, patches, etc.
to: <a href="http://rt.cpan.org/Public/Dist/Display.html?Name=threads-shared">http://rt.cpan.org/Public/Dist/Display.html?Name=threads-shared</a></p>
<a class='view-head1' id="SEE-ALSO"></a><h2 class='h2' >SEE ALSO</h2>
<p>threads::shared on MetaCPAN:
<a class='link-to-page' href="https://metacpan.org/release/threads-shared">https://metacpan.org/release/threads-shared</a></p>
<p>Code repository for CPAN distribution:
<a class='link-to-page' href="https://github.com/Dual-Life/threads-shared">https://github.com/Dual-Life/threads-shared</a></p>
<p><a href="../threads.html">threads</a>, <a href="../perlthrtut.html">perlthrtut</a></p>
<p><a href="http://www.perl.com/pub/a/2002/06/11/threads.html">http://www.perl.com/pub/a/2002/06/11/threads.html</a> and
<a href="http://www.perl.com/pub/a/2002/09/04/threads.html">http://www.perl.com/pub/a/2002/09/04/threads.html</a></p>
<p>Perl threads mailing list:
<a href="http://lists.perl.org/list/ithreads.html">http://lists.perl.org/list/ithreads.html</a></p>
<p>Sample code in the <i>examples</i> directory of this distribution on CPAN.</p>
<a class='view-head1' id="AUTHOR"></a><h2 class='h2' >AUTHOR</h2>
<p>Artur Bergman &lt;sky AT crucially DOT net&gt;</p>
<p>Documentation borrowed from the old Thread.pm.</p>
<p>CPAN version produced by Jerry D. Hedden &lt;jdhedden AT cpan DOT org&gt;.</p>
<a class='view-head1' id="LICENSE"></a><h2 class='h2' >LICENSE</h2>
<p>threads::shared is released under the same license as Perl.</p>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#VERSION">VERSION</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><li><a href="#EXPORT">EXPORT</a></li><li><a href="#FUNCTIONS">FUNCTIONS</a></li><li><a href="#OBJECTS">OBJECTS</a></li><li><a href="#NOTES">NOTES</a></li><li><a href="#WARNINGS">WARNINGS</a></li><li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li><li><a href="#SEE-ALSO">SEE ALSO</a></li><li><a href="#AUTHOR">AUTHOR</a></li><li><a href="#LICENSE">LICENSE</a></li></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.30.0/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.30.0/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.30.0/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
