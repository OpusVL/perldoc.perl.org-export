      
      
      
      

      <!DOCTYPE html>
      <html lang="en">

      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="perliol - perldoc.perl.org">
        <link rel="icon" href="/public/img/favicon.ico">
        <title>perliol - perldoc.perl.org</title>
        <link href="/public/css/main.min.css" rel="stylesheet">
        <link rel="canonical" href="/perliol.html">
        <link
          href='https://fonts.googleapis.com/css?family=Lato:400,100,300,700,900'
          rel='stylesheet' type='text/css'>
        <script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
          };
          ga.l = +new Date;
          ga('create', 'UA-1892152-2', 'auto'); // JJ's account
          ga('create', 'UA-50555-3', 'auto', 'perlOrg'); // perl.org account
          ga('require', 'outboundLinkTracker', {
            events: ['click', 'auxclick', 'contextmenu'],
          });
          ga('require', 'maxScrollTracker');
          ga('send', 'pageview');
          ga('perlOrg.send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js">
        </script>
        <script async src="/public/js/tracking.min.js"></script>
      </head>

      <body class="body container-fluid ">
        <div class="wrapper">

          <nav
    class="navbar navbar-dark bg-primary bg-perl fixed-top justify-content-between navbar-expand-lg">
    <a href="#content" class="skippy sr-only sr-only-focusable">
        <span class=' skippy-text'>Skip to main content</span>
    </a>
    <a class="navbar-brand" href="/">
        <img class="logo" src="/public/img/logo_perl_doc.svg"
            alt="Perl Documentation Logo" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#navbar" aria-controls="navbar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse ">
        <ul class="navbar-nav ml-auto navbar-right">
            <form class="nav-item dropdown search-wrapper">
                <input type="text" id='searchinput' aria-describedby='navbarDropdown5'
                    placeholder="Type query" class='search-input-field' value=''>

                <button href="#" data-toggle='dropdown' type="button"
                    aria-haspopup="true" aria-expanded='false' id="navbarDropdown5"
                    class="nav-link dropdown-toggle search-link">
                    <object tabindex='-1' focusable="false" class='search-icon'
                        data="/public/img/search.svg" type="image/svg+xml"
                        name='search icon'>search
                        icon</object>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown5"
                    id='search-results'>
                    <p class='dropdown-item major-version'>
                        No results
                    </p>
                </div>
            </form>
            <li class="nav-item dropdown">
                <a id="navbarDropdown" href="#" class="nav-link dropdown-toggle"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Perl versions</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                        <p class='dropdown-item major-version'>
                            5.32
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.32.0/">5.32.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.30
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.30.3/">5.30.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.2/">5.30.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.1/">5.30.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.30.0/">5.30.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.28
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.28.3/">5.28.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.2/">5.28.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.1/">5.28.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.28.0/">5.28.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.26
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.26.3/">5.26.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.2/">5.26.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.1/">5.26.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.26.0/">5.26.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.24
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.24.4/">5.24.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.3/">5.24.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.2/">5.24.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.1/">5.24.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.24.0/">5.24.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.22
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.22.4/">5.22.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.3/">5.22.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.2/">5.22.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.1/">5.22.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.22.0/">5.22.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.20
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.20.3/">5.20.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.2/">5.20.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.1/">5.20.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.20.0/">5.20.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.18
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.18.4/">5.18.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.3/">5.18.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.2/">5.18.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.1/">5.18.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.18.0/">5.18.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.16
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.16.3/">5.16.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.2/">5.16.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.1/">5.16.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.16.0/">5.16.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.14
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.14.4/">5.14.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.3/">5.14.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.2/">5.14.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.1/">5.14.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.14.0/">5.14.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.12
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.12.5/">5.12.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.4/">5.12.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.3/">5.12.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.2/">5.12.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.1/">5.12.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.12.0/">5.12.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.10
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.10.1/">5.10.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.10.0/">5.10.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.8
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.8.9/">5.8.9</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.8/">5.8.8</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.7/">5.8.7</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.6/">5.8.6</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.5/">5.8.5</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.4/">5.8.4</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.3/">5.8.3</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.2/">5.8.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.1/">5.8.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.8.0/">5.8.0</a>
                        
                        
                        <div class="dropdown-divider"></div>
                        
                    
                        <p class='dropdown-item major-version'>
                            5.6
                        </p>
                        
                        <a class='dropdown-item minor-version' href="/5.6.2/">5.6.2</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.1/">5.6.1</a>
                        
                        <a class='dropdown-item minor-version' href="/5.6.0/">5.6.0</a>
                        
                        
                    
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown1" href="#" class="dropdown-toggle nav-link"
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Manuals</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                    <a class="dropdown-item"
                        href="/5.16.2/index-overview.html">Overview</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-tutorials.html">Tutorials</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-faq.html">FAQs</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-history.html">Changes</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-licence.html">License</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-language.html">Language</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-functions.html">Functions</a>
                    <a class="dropdown-item"
                        href="/5.16.2/perlop.html">Operators</a>
                    <a class="dropdown-item"
                        href="/5.16.2/perlvar.html">Variables</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-pragmas.html">Pragmas</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-utilities.html">Utilities</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-internals.html">Internals</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-platforms.html">Platforms</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown3" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Modules</a>
                <div aria-labelledby="navbarDropdown3"
                    class="dropdown-menu letters-wrap">
                    <!--<a class="dropdown-item"
                        href="/5.16.2/index-modules.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-modules-by-cat.html">By
                        Category</a>-->
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-A.html">A</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-B.html">B</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-C.html">C</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-D.html">D</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-E.html">E</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-F.html">F</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-G.html">G</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-H.html">H</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-I.html">I</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-J.html">J</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-K.html">K</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-L.html">L</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-M.html">M</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-N.html">N</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-O.html">O</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-P.html">P</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-Q.html">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-R.html">R</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-S.html">S</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-T.html">T</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-U.html">U</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-V.html">V</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-W.html">W</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-X.html">X</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-Y.html">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-modules-Z.html">Z</a>
                    </div>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a id="navbarDropdown4" href="#" class="nav-link dropdown-toggle "
                    data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false">Functions</a>
                <div aria-labelledby="navbarDropdown4"
                    class="dropdown-menu letters-wrap">
                    <a class="dropdown-item"
                        href="/5.16.2/index-functions.html">A-Z</a>
                    <a class="dropdown-item"
                        href="/5.16.2/index-functions-by-cat.html">By
                        Category</a>
                    <div class="dropdown-divider"></div>
                    <div class="letter-container">
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#A">A</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#B">B</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#C">C</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#D">D</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#E">E</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#F">F</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#G">G</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#H">H</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#I">I</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#J">J</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#K">K</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#L">L</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#M">M</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#N">N</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#O">O</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#P">P</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#Q">Q</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#R">R</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#S">S</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#T">T</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#U">U</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#V">V</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#W">W</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#X">X</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#Y">Y</a>
                        <a class="dropdown-item letters"
                            href="/5.16.2/index-functions.html#Z">Z</a>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--/.nav-collapse -->
</nav>


          <main class="row main-content pb-5 pt-5" id='content'>
            <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
              <div class="row">
                <div class="col-sm-12">
                  <div id="breadcrumbs">
                      
    <a href="index.html">Home</a>&nbsp; &gt;
    
      
        <a href="index-internals.html">Internals and C language interface</a> &gt;
      
    
    perliol
  

                  </div>
                </div>
              </div>
              <div class="row">
                <article class="col-sm-12 content">
                  <div class="documentation-wrapper">
                    <div id="perl_version">
                      <h7 class='page-title'> Perl 5 version 16.2
                        documentation</h7>
                    </div>
                    <h1>perliol</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><ul><li><a href="#History-and-Background">History and Background</a></li><li><a href="#Basic-Structure">Basic Structure</a></li><li><a href="#Layers-vs-Disciplines">Layers vs Disciplines</a></li><li><a href="#Data-Structures">Data Structures</a></li><li><a href="#Functions-and-Attributes">Functions and Attributes</a></li><li><a href="#Per-instance-Data">Per-instance Data</a></li><li><a href="#Layers-in-action.">Layers in action.</a></li><li><a href="#Per-instance-flag-bits">Per-instance flag bits</a></li><li><a href="#Methods-in-Detail">Methods in Detail</a></li><li><a href="#Utilities">Utilities</a></li><li><a href="#Implementing-PerlIO-Layers">Implementing PerlIO Layers</a></li><li><a href="#Core-Layers">Core Layers</a></li><li><a href="#Extension-Layers">Extension Layers</a></li></ul><li><a href="#TODO">TODO</a></li></ul><a class='view-head1' id="NAME"></a><h2 class='h2' >NAME</h2>
<p>perliol - C API for Perl's implementation of IO in Layers.</p>
<a class='view-head1' id="SYNOPSIS"></a><h2 class='h2' >SYNOPSIS</h2>
<pre class="verbatim"><ol><li>    <span class="q">/* Defining a layer ... */</span></li><li>    <span class="c">#include &lt;perliol.h&gt;</span></li></ol></pre><a class='view-head1' id="DESCRIPTION"></a><h2 class='h2' >DESCRIPTION</h2>
<p>This document describes the behavior and implementation of the PerlIO
abstraction described in <a href="perlapio.html">perlapio</a> when <code class="inline"><span class="w">USE_PERLIO</span></code>
 is defined (and
<code class="inline"><span class="w">USE_SFIO</span></code>
 is not).</p>
<a class='view-head2' id="History-and-Background"></a><h3 class='h3' >History and Background</h3>
<p>The PerlIO abstraction was introduced in perl5.003_02 but languished as
just an abstraction until perl5.7.0. However during that time a number
of perl extensions switched to using it, so the API is mostly fixed to
maintain (source) compatibility.</p>
<p>The aim of the implementation is to provide the PerlIO API in a flexible
and platform neutral manner. It is also a trial of an "Object Oriented
C, with vtables" approach which may be applied to Perl 6.</p>
<a class='view-head2' id="Basic-Structure"></a><h3 class='h3' >Basic Structure</h3>
<p>PerlIO is a stack of layers.</p>
<p>The low levels of the stack work with the low-level operating system
calls (file descriptors in C) getting bytes in and out, the higher
layers of the stack buffer, filter, and otherwise manipulate the I/O,
and return characters (or bytes) to Perl.  Terms <i>above</i> and <i>below</i>
are used to refer to the relative positioning of the stack layers.</p>
<p>A layer contains a "vtable", the table of I/O operations (at C level
a table of function pointers), and status flags.  The functions in the
vtable implement operations like "open", "read", and "write".</p>
<p>When I/O, for example "read", is requested, the request goes from Perl
first down the stack using "read" functions of each layer, then at the
bottom the input is requested from the operating system services, then
the result is returned up the stack, finally being interpreted as Perl
data.</p>
<p>The requests do not necessarily go always all the way down to the
operating system: that's where PerlIO buffering comes into play.</p>
<p>When you do an open() and specify extra PerlIO layers to be deployed,
the layers you specify are "pushed" on top of the already existing
default stack.  One way to see it is that "operating system is
on the left" and "Perl is on the right".</p>
<p>What exact layers are in this default stack depends on a lot of
things: your operating system, Perl version, Perl compile time
configuration, and Perl runtime configuration.  See <a href="PerlIO.html">PerlIO</a>,
<a href="perlrun.html#PERLIO">PERLIO in perlrun</a>, and <a href="open.html">open</a> for more information.</p>
<p>binmode() operates similarly to open(): by default the specified
layers are pushed on top of the existing stack.</p>
<p>However, note that even as the specified layers are "pushed on top"
for open() and binmode(), this doesn't mean that the effects are
limited to the "top": PerlIO layers can be very 'active' and inspect
and affect layers also deeper in the stack.  As an example there
is a layer called "raw" which repeatedly "pops" layers until
it reaches the first layer that has declared itself capable of
handling binary data.  The "pushed" layers are processed in left-to-right
order.</p>
<p>sysopen() operates (unsurprisingly) at a lower level in the stack than
open().  For example in Unix or Unix-like systems sysopen() operates
directly at the level of file descriptors: in the terms of PerlIO
layers, it uses only the "unix" layer, which is a rather thin wrapper
on top of the Unix file descriptors.</p>
<a class='view-head2' id="Layers-vs-Disciplines"></a><h3 class='h3' >Layers vs Disciplines</h3>
<p>Initial discussion of the ability to modify IO streams behaviour used
the term "discipline" for the entities which were added. This came (I
believe) from the use of the term in "sfio", which in turn borrowed it
from "line disciplines" on Unix terminals. However, this document (and
the C code) uses the term "layer".</p>
<p>This is, I hope, a natural term given the implementation, and should
avoid connotations that are inherent in earlier uses of "discipline"
for things which are rather different.</p>
<a class='view-head2' id="Data-Structures"></a><h3 class='h3' >Data Structures</h3>
<p>The basic data structure is a PerlIOl:</p>
<pre class="verbatim"><ol><li>	<span class="w">typedef</span> <span class="w">struct</span> <span class="w">_PerlIO</span> <span class="w">PerlIOl</span><span class="sc">;</span></li><li>	<span class="w">typedef</span> <span class="w">struct</span> <span class="w">_PerlIO_funcs</span> <span class="w">PerlIO_funcs</span><span class="sc">;</span></li><li>	<span class="w">typedef</span> <span class="w">PerlIOl</span> *<span class="w">PerlIO</span><span class="sc">;</span></li><li></li><li>	<span class="w">struct</span> <span class="w">_PerlIO</span></li><li>	<span class="s">{</span></li><li>	 <span class="w">PerlIOl</span> *	<a class="l_k" href="functions/next.html">next</a><span class="sc">;</span>       <span class="q">/* Lower layer */</span></li><li>	 <span class="w">PerlIO_funcs</span> *	<span class="w">tab</span><span class="sc">;</span>        <span class="q">/* Functions for this layer */</span></li><li>	 <span class="w">IV</span>		<span class="w">flags</span><span class="sc">;</span>      <span class="q">/* Various flags for state */</span></li><li>	<span class="s">}</span><span class="sc">;</span></li></ol></pre><p>A <code class="inline"><span class="w">PerlIOl</span> *</code>
 is a pointer to the struct, and the <i>application</i>
level <code class="inline"><span class="w">PerlIO</span> *</code>
 is a pointer to a <code class="inline"><span class="w">PerlIOl</span> *</code>
 - i.e. a pointer
to a pointer to the struct. This allows the application level <code class="inline"><span class="w">PerlIO</span> *</code>

to remain constant while the actual <code class="inline"><span class="w">PerlIOl</span> *</code>
 underneath
changes. (Compare perl's <code class="inline"><span class="w">SV</span> *</code>
 which remains constant while its
<code class="inline"><span class="w">sv_any</span></code>
 field changes as the scalar's type changes.) An IO stream is
then in general represented as a pointer to this linked-list of
"layers".</p>
<p>It should be noted that because of the double indirection in a <code class="inline"><span class="w">PerlIO</span> *</code>
,
a <code class="inline"><span class="i">&amp;(</span><span class="w">perlio</span><span class="w">-&gt;next</span><span class="p">)</span></code>
 "is" a <code class="inline"><span class="w">PerlIO</span> *</code>
, and so to some degree
at least one layer can use the "standard" API on the next layer down.</p>
<p>A "layer" is composed of two parts:</p>
<dl>
<li>
<p>The functions and attributes of the "layer class".</p>
</li>
<li>
<p>The per-instance data for a particular handle.</p>
</li>
</dl>
<a class='view-head2' id="Functions-and-Attributes"></a><h3 class='h3' >Functions and Attributes</h3>
<p>The functions and attributes are accessed via the "tab" (for table)
member of <code class="inline"><span class="w">PerlIOl</span></code>
. The functions (methods of the layer "class") are
fixed, and are defined by the <code class="inline"><span class="w">PerlIO_funcs</span></code>
 type. They are broadly the
same as the public <code class="inline"><span class="w">PerlIO_xxxxx</span></code>
 functions:</p>
<pre class="verbatim"><ol><li>  <span class="w">struct</span> <span class="w">_PerlIO_funcs</span></li><li>  <span class="s">{</span></li><li>   <span class="w">Size_t</span>		<span class="w">fsize</span><span class="sc">;</span></li><li>   <span class="w">char</span> *		<span class="w">name</span><span class="sc">;</span></li><li>   <span class="w">Size_t</span>		<span class="w">size</span><span class="sc">;</span></li><li>   <span class="w">IV</span>		<span class="w">kind</span><span class="sc">;</span></li><li>   <span class="w">IV</span>		<span class="s">(</span><span class="i">*Pushed</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span><span class="w">const</span> <span class="w">char</span> *<span class="w">mode</span><span class="cm">,</span><span class="w">SV</span> *<span class="w">arg</span><span class="cm">,</span> <span class="w">PerlIO_funcs</span> *<span class="w">tab</span><span class="s">)</span><span class="sc">;</span></li><li>   <span class="w">IV</span>		<span class="s">(</span><span class="i">*Popped</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li><li>   <span class="w">PerlIO</span> *	<span class="s">(</span><span class="i">*Open</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO_funcs</span> *<span class="w">tab</span><span class="cm">,</span></li><li>  			<span class="w">PerlIO_list_t</span> *<span class="w">layers</span><span class="cm">,</span> <span class="w">IV</span> <span class="w">n</span><span class="cm">,</span></li><li>  			<span class="w">const</span> <span class="w">char</span> *<span class="w">mode</span><span class="cm">,</span></li><li>  			<a class="l_k" href="functions/int.html">int</a> <span class="w">fd</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">imode</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">perm</span><span class="cm">,</span></li><li>  			<span class="w">PerlIO</span> *<span class="w">old</span><span class="cm">,</span></li><li>  			<a class="l_k" href="functions/int.html">int</a> <span class="w">narg</span><span class="cm">,</span> <span class="w">SV</span> **<span class="w">args</span><span class="s">)</span><span class="sc">;</span></li><li>   <span class="w">IV</span>		<span class="s">(</span><span class="i">*Binmode</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li><li>   <span class="w">SV</span> *		<span class="s">(</span><span class="i">*Getarg</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">flags</span><span class="s">)</span></li><li>   <span class="w">IV</span>		<span class="s">(</span><span class="i">*Fileno</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li><li>   <span class="w">PerlIO</span> *     <span class="s">(</span><span class="i">*Dup</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">PerlIO</span> *<span class="w">o</span><span class="cm">,</span> <span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">flags</span><span class="s">)</span></li><li>   /<span class="i">* Unix</span>-<span class="w">like</span> <span class="w">functions</span> - <span class="w">cf</span> <span class="w">sfio</span> <span class="w">line</span> <span class="w">disciplines</span> *<span class="q">/</span></li><li>   <span class="q">   SSize_t	(*Read)(pTHX_ PerlIO *f, void *vbuf, Size_t count);</span></li><li>   <span class="q">   SSize_t	(*Unread)(pTHX_ PerlIO *f, const void *vbuf, Size_t count);</span></li><li>   <span class="q">   SSize_t	(*Write)(pTHX_ PerlIO *f, const void *vbuf, Size_t count);</span></li><li>   <span class="q">   IV		(*Seek)(pTHX_ PerlIO *f, Off_t offset, int whence);</span></li><li>   <span class="q">   Off_t	(*Tell)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   IV		(*Close)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   /</span>* <span class="w">Stdio</span>-<span class="w">like</span> <span class="w">buffered</span> <span class="w">IO</span> <span class="w">functions</span> *<span class="q">/</span></li><li>   <span class="q">   IV		(*Flush)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   IV		(*Fill)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   IV		(*Eof)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   IV		(*Error)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   void		(*Clearerr)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   void		(*Setlinebuf)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   /</span>* <span class="w">Perl&#39;s</span> <span class="w">snooping</span> <span class="w">functions</span> *<span class="q">/</span></li><li>   <span class="q">   STDCHAR *	(*Get_base)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   Size_t	(*Get_bufsiz)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   STDCHAR *	(*Get_ptr)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   SSize_t	(*Get_cnt)(pTHX_ PerlIO *f);</span></li><li>   <span class="q">   void		(*Set_ptrcnt)(pTHX_ PerlIO *f,STDCHAR *ptr,SSize_t cnt);</span></li><li>  <span class="q">  };</span></li></ol></pre><p>The first few members of the struct give a function table size for
compatibility check "name" for the layer, the  size to <code class="inline"><span class="w">malloc</span></code>
 for the per-instance data,
and some flags which are attributes of the class as whole (such as whether it is a buffering
layer), then follow the functions which fall into four basic groups:</p>
<dl>
<li>
<p>Opening and setup functions</p>
</li>
<li>
<p>Basic IO operations</p>
</li>
<li>
<p>Stdio class buffering options.</p>
</li>
<li>
<p>Functions to support Perl's traditional "fast" access to the buffer.</p>
</li>
</dl>
<p>A layer does not have to implement all the functions, but the whole
table has to be present. Unimplemented slots can be NULL (which will
result in an error when called) or can be filled in with stubs to
"inherit" behaviour from a "base class". This "inheritance" is fixed
for all instances of the layer, but as the layer chooses which stubs
to populate the table, limited "multiple inheritance" is possible.</p>
<a class='view-head2' id="Per-instance-Data"></a><h3 class='h3' >Per-instance Data</h3>
<p>The per-instance data are held in memory beyond the basic PerlIOl
struct, by making a PerlIOl the first member of the layer's struct
thus:</p>
<pre class="verbatim"><ol><li>	<span class="w">typedef</span> <span class="w">struct</span></li><li>	<span class="s">{</span></li><li>	 <span class="w">struct</span> <span class="w">_PerlIO</span> <span class="w">base</span><span class="sc">;</span>       <span class="q">/* Base &quot;class&quot; info */</span></li><li>	 <span class="w">STDCHAR</span> *	<span class="w">buf</span><span class="sc">;</span>        <span class="q">/* Start of buffer */</span></li><li>	 <span class="w">STDCHAR</span> *	<span class="w">end</span><span class="sc">;</span>        <span class="q">/* End of valid part of buffer */</span></li><li>	 <span class="w">STDCHAR</span> *	<span class="w">ptr</span><span class="sc">;</span>        <span class="q">/* Current position in buffer */</span></li><li>	 <span class="w">Off_t</span>		<span class="w">posn</span><span class="sc">;</span>       <span class="q">/* Offset of buf into the file */</span></li><li>	 <span class="w">Size_t</span>		<span class="w">bufsiz</span><span class="sc">;</span>     <span class="q">/* Real size of buffer */</span></li><li>	 <span class="w">IV</span>		<span class="w">oneword</span><span class="sc">;</span>    <span class="q">/* Emergency buffer */</span></li><li>	<span class="s">}</span> <span class="w">PerlIOBuf</span><span class="sc">;</span></li></ol></pre><p>In this way (as for perl's scalars) a pointer to a PerlIOBuf can be
treated as a pointer to a PerlIOl.</p>
<a class='view-head2' id="Layers-in-action."></a><h3 class='h3' >Layers in action.</h3>
<pre class="verbatim"><ol><li>                <span class="w">table</span>           <span class="w">perlio</span>          <span class="w">unix</span></li><li>            |           |</li><li>            +-----------+    +----------+    +--------+</li><li>   <span class="w">PerlIO</span> -&gt;|           |---&gt;|  <a class="l_k" href="functions/next.html">next</a>    |---&gt;|  <span class="w">NULL</span>  |</li><li>            +-----------+    +----------+    +--------+</li><li>            |           |    |  <span class="w">buffer</span>  |    |   <span class="w">fd</span>   |</li><li>            +-----------+    |          |    +--------+</li><li>            |           |    +----------+</li></ol></pre><p>The above attempts to show how the layer scheme works in a simple case.
The application's <code class="inline"><span class="w">PerlIO</span> *</code>
 points to an entry in the table(s)
representing open (allocated) handles. For example the first three slots
in the table correspond to <code class="inline"><span class="w">stdin</span></code>
,<code class="inline"><span class="w">stdout</span></code>
 and <code class="inline"><span class="w">stderr</span></code>
. The table
in turn points to the current "top" layer for the handle - in this case
an instance of the generic buffering layer "perlio". That layer in turn
points to the next layer down - in this case the low-level "unix" layer.</p>
<p>The above is roughly equivalent to a "stdio" buffered stream, but with
much more flexibility:</p>
<ul>
<li>
<p>If Unix level <code class="inline"><a class="l_k" href="functions/read.html">read</a></code>/<code class="inline"><a class="l_k" href="functions/write.html">write</a></code>/<code class="inline"><span class="w">lseek</span></code>
 is not appropriate for (say)
sockets then the "unix" layer can be replaced (at open time or even
dynamically) with a "socket" layer.</p>
</li>
<li>
<p>Different handles can have different buffering schemes. The "top"
layer could be the "mmap" layer if reading disk files was quicker
using <code class="inline"><span class="w">mmap</span></code>
 than <code class="inline"><a class="l_k" href="functions/read.html">read</a></code>. An "unbuffered" stream can be implemented
simply by not having a buffer layer.</p>
</li>
<li>
<p>Extra layers can be inserted to process the data as it flows through.
This was the driving need for including the scheme in perl 5.7.0+ - we
needed a mechanism to allow data to be translated between perl's
internal encoding (conceptually at least Unicode as UTF-8), and the
"native" format used by the system. This is provided by the
":encoding(xxxx)" layer which typically sits above the buffering layer.</p>
</li>
<li>
<p>A layer can be added that does "\n" to CRLF translation. This layer
can be used on any platform, not just those that normally do such
things.</p>
</li>
</ul>
<a class='view-head2' id="Per-instance-flag-bits"></a><h3 class='h3' >Per-instance flag bits</h3>
<p>The generic flag bits are a hybrid of <code class="inline"><span class="w">O_XXXXX</span></code>
 style flags deduced
from the mode string passed to <code class="inline"><span class="i">PerlIO_open</span><span class="s">(</span><span class="s">)</span></code>
, and state bits for
typical buffer layers.</p>
<ul>
<li><a class='view-title' id="PERLIO_F_EOF"></a><strong>PERLIO_F_EOF</strong>
<p>End of file.</p>
</li>
<li><a class='view-title' id="PERLIO_F_CANWRITE"></a><strong>PERLIO_F_CANWRITE</strong>
<p>Writes are permitted, i.e. opened as "w" or "r+" or "a", etc.</p>
</li>
<li><a class='view-title' id="PERLIO_F_CANREAD"></a><strong>PERLIO_F_CANREAD</strong>
<p>Reads are permitted i.e. opened "r" or "w+" (or even "a+" - ick).</p>
</li>
<li><a class='view-title' id="PERLIO_F_ERROR"></a><strong>PERLIO_F_ERROR</strong>
<p>An error has occurred (for <code class="inline"><span class="i">PerlIO_error</span><span class="s">(</span><span class="s">)</span></code>
).</p>
</li>
<li><a class='view-title' id="PERLIO_F_TRUNCATE"></a><strong>PERLIO_F_TRUNCATE</strong>
<p>Truncate file suggested by open mode.</p>
</li>
<li><a class='view-title' id="PERLIO_F_APPEND"></a><strong>PERLIO_F_APPEND</strong>
<p>All writes should be appends.</p>
</li>
<li><a class='view-title' id="PERLIO_F_CRLF"></a><strong>PERLIO_F_CRLF</strong>
<p>Layer is performing Win32-like "\n" mapped to CR,LF for output and CR,LF
mapped to "\n" for input. Normally the provided "crlf" layer is the only
layer that need bother about this. <code class="inline"><span class="i">PerlIO_binmode</span><span class="s">(</span><span class="s">)</span></code>
 will mess with this
flag rather than add/remove layers if the <code class="inline"><span class="w">PERLIO_K_CANCRLF</span></code>
 bit is set
for the layers class.</p>
</li>
<li><a class='view-title' id="PERLIO_F_UTF8"></a><strong>PERLIO_F_UTF8</strong>
<p>Data written to this layer should be UTF-8 encoded; data provided
by this layer should be considered UTF-8 encoded. Can be set on any layer
by ":utf8" dummy layer. Also set on ":encoding" layer.</p>
</li>
<li><a class='view-title' id="PERLIO_F_UNBUF"></a><strong>PERLIO_F_UNBUF</strong>
<p>Layer is unbuffered - i.e. write to next layer down should occur for
each write to this layer.</p>
</li>
<li><a class='view-title' id="PERLIO_F_WRBUF"></a><strong>PERLIO_F_WRBUF</strong>
<p>The buffer for this layer currently holds data written to it but not sent
to next layer.</p>
</li>
<li><a class='view-title' id="PERLIO_F_RDBUF"></a><strong>PERLIO_F_RDBUF</strong>
<p>The buffer for this layer currently holds unconsumed data read from
layer below.</p>
</li>
<li><a class='view-title' id="PERLIO_F_LINEBUF"></a><strong>PERLIO_F_LINEBUF</strong>
<p>Layer is line buffered. Write data should be passed to next layer down
whenever a "\n" is seen. Any data beyond the "\n" should then be
processed.</p>
</li>
<li><a class='view-title' id="PERLIO_F_TEMP"></a><strong>PERLIO_F_TEMP</strong>
<p>File has been <code class="inline"><a class="l_k" href="functions/unlink.html">unlink()</a></code>ed, or should be deleted on <code class="inline"><a class="l_k" href="functions/close.html">close()</a></code>.</p>
</li>
<li><a class='view-title' id="PERLIO_F_OPEN"></a><strong>PERLIO_F_OPEN</strong>
<p>Handle is open.</p>
</li>
<li><a class='view-title' id="PERLIO_F_FASTGETS"></a><strong>PERLIO_F_FASTGETS</strong>
<p>This instance of this layer supports the "fast <code class="inline"><span class="w">gets</span></code>
" interface.
Normally set based on <code class="inline"><span class="w">PERLIO_K_FASTGETS</span></code>
 for the class and by the
existence of the function(s) in the table. However a class that
normally provides that interface may need to avoid it on a
particular instance. The "pending" layer needs to do this when
it is pushed above a layer which does not support the interface.
(Perl's <code class="inline"><span class="i">sv_gets</span><span class="s">(</span><span class="s">)</span></code>
 does not expect the streams fast <code class="inline"><span class="w">gets</span></code>
 behaviour
to change during one "get".)</p>
</li>
</ul>
<a class='view-head2' id="Methods-in-Detail"></a><h3 class='h3' >Methods in Detail</h3>
<ul>
<li><a class='view-title' id="fsize"></a><strong>fsize</strong>
<pre class="verbatim"><ol><li>	<span class="w">Size_t</span> <span class="w">fsize</span><span class="sc">;</span></li></ol></pre><p>Size of the function table. This is compared against the value PerlIO
code "knows" as a compatibility check. Future versions <i>may</i> be able
to tolerate layers compiled against an old version of the headers.</p>
</li>
<li><a class='view-title' id="name"></a><strong>name</strong>
<pre class="verbatim"><ol><li>	<span class="w">char</span> * <span class="w">name</span><span class="sc">;</span></li></ol></pre><p>The name of the layer whose open() method Perl should invoke on
open().  For example if the layer is called APR, you will call:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/open.html">open</a> <span class="i">$fh</span><span class="cm">,</span> <span class="q">&quot;&gt;:APR&quot;</span><span class="cm">,</span> ...</li></ol></pre><p>and Perl knows that it has to invoke the PerlIOAPR_open() method
implemented by the APR layer.</p>
</li>
<li><a class='view-title' id="size"></a><strong>size</strong>
<pre class="verbatim"><ol><li>	<span class="w">Size_t</span> <span class="w">size</span><span class="sc">;</span></li></ol></pre><p>The size of the per-instance data structure, e.g.:</p>
<pre class="verbatim"><ol><li>  <span class="i">sizeof</span><span class="s">(</span><span class="w">PerlIOAPR</span><span class="s">)</span></li></ol></pre><p>If this field is zero then <code class="inline"><span class="w">PerlIO_pushed</span></code>
 does not malloc anything
and assumes layer's Pushed function will do any required layer stack
manipulation - used to avoid malloc/free overhead for dummy layers.
If the field is non-zero it must be at least the size of <code class="inline"><span class="w">PerlIOl</span></code>
,
<code class="inline"><span class="w">PerlIO_pushed</span></code>
 will allocate memory for the layer's data structures
and link new layer onto the stream's stack. (If the layer's Pushed
method returns an error indication the layer is popped again.)</p>
</li>
<li><a class='view-title' id="kind"></a><strong>kind</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span> <span class="w">kind</span><span class="sc">;</span></li></ol></pre><ul>
<li><a class='view-title' id="*-PERLIO_K_BUFFERED"></a><strong>PERLIO_K_BUFFERED</strong>
<p>The layer is buffered.</p>
</li>
<li><a class='view-title' id="*-PERLIO_K_RAW"></a><strong>PERLIO_K_RAW</strong>
<p>The layer is acceptable to have in a binmode(FH) stack - i.e. it does not
(or will configure itself not to) transform bytes passing through it.</p>
</li>
<li><a class='view-title' id="*-PERLIO_K_CANCRLF"></a><strong>PERLIO_K_CANCRLF</strong>
<p>Layer can translate between "\n" and CRLF line ends.</p>
</li>
<li><a class='view-title' id="*-PERLIO_K_FASTGETS"></a><strong>PERLIO_K_FASTGETS</strong>
<p>Layer allows buffer snooping.</p>
</li>
<li><a class='view-title' id="*-PERLIO_K_MULTIARG"></a><strong>PERLIO_K_MULTIARG</strong>
<p>Used when the layer's open() accepts more arguments than usual. The
extra arguments should come not before the <code class="inline"><span class="w">MODE</span></code>
 argument. When this
flag is used it's up to the layer to validate the args.</p>
</li>
</ul>
</li>
<li><a class='view-title' id="Pushed"></a><strong>Pushed</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Pushed</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span><span class="w">const</span> <span class="w">char</span> *<span class="w">mode</span><span class="cm">,</span> <span class="w">SV</span> *<span class="w">arg</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The only absolutely mandatory method. Called when the layer is pushed
onto the stack.  The <code class="inline"><span class="w">mode</span></code>
 argument may be NULL if this occurs
post-open. The <code class="inline"><span class="w">arg</span></code>
 will be non-<code class="inline"><span class="w">NULL</span></code>
 if an argument string was
passed. In most cases this should call <code class="inline"><span class="i">PerlIOBase_pushed</span><span class="s">(</span><span class="s">)</span></code>
 to
convert <code class="inline"><span class="w">mode</span></code>
 into the appropriate <code class="inline"><span class="w">PERLIO_F_XXXXX</span></code>
 flags in
addition to any actions the layer itself takes.  If a layer is not
expecting an argument it need neither save the one passed to it, nor
provide <code class="inline"><span class="i">Getarg</span><span class="s">(</span><span class="s">)</span></code>
 (it could perhaps <code class="inline"><span class="w">Perl_warn</span></code>
 that the argument
was un-expected).</p>
<p>Returns 0 on success. On failure returns -1 and should set errno.</p>
</li>
<li><a class='view-title' id="Popped"></a><strong>Popped</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Popped</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Called when the layer is popped from the stack. A layer will normally
be popped after <code class="inline"><span class="i">Close</span><span class="s">(</span><span class="s">)</span></code>
 is called. But a layer can be popped
without being closed if the program is dynamically managing layers on
the stream. In such cases <code class="inline"><span class="i">Popped</span><span class="s">(</span><span class="s">)</span></code>
 should free any resources
(buffers, translation tables, ...) not held directly in the layer's
struct.  It should also <code class="inline"><span class="i">Unread</span><span class="s">(</span><span class="s">)</span></code>
 any unconsumed data that has been
read and buffered from the layer below back to that layer, so that it
can be re-provided to what ever is now above.</p>
<p>Returns 0 on success and failure.  If <code class="inline"><span class="i">Popped</span><span class="s">(</span><span class="s">)</span></code>
 returns <i>true</i> then
<i>perlio.c</i> assumes that either the layer has popped itself, or the
layer is super special and needs to be retained for other reasons.
In most cases it should return <i>false</i>.</p>
</li>
<li><a class='view-title' id="Open"></a><strong>Open</strong>
<pre class="verbatim"><ol><li>	<span class="w">PerlIO</span> *	<span class="s">(</span><span class="i">*Open</span><span class="s">)</span><span class="s">(</span>...<span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The <code class="inline"><span class="i">Open</span><span class="s">(</span><span class="s">)</span></code>
 method has lots of arguments because it combines the
functions of perl's <code class="inline"><a class="l_k" href="functions/open.html">open</a></code>, <code class="inline"><span class="w">PerlIO_open</span></code>
, perl's <code class="inline"><a class="l_k" href="functions/sysopen.html">sysopen</a></code>,
<code class="inline"><span class="w">PerlIO_fdopen</span></code>
 and <code class="inline"><span class="w">PerlIO_reopen</span></code>
.  The full prototype is as
follows:</p>
<pre class="verbatim"><ol><li> <span class="w">PerlIO</span> *	<span class="s">(</span><span class="i">*Open</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO_funcs</span> *<span class="w">tab</span><span class="cm">,</span></li><li>			<span class="w">PerlIO_list_t</span> *<span class="w">layers</span><span class="cm">,</span> <span class="w">IV</span> <span class="w">n</span><span class="cm">,</span></li><li>			<span class="w">const</span> <span class="w">char</span> *<span class="w">mode</span><span class="cm">,</span></li><li>			<a class="l_k" href="functions/int.html">int</a> <span class="w">fd</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">imode</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">perm</span><span class="cm">,</span></li><li>			<span class="w">PerlIO</span> *<span class="w">old</span><span class="cm">,</span></li><li>			<a class="l_k" href="functions/int.html">int</a> <span class="w">narg</span><span class="cm">,</span> <span class="w">SV</span> **<span class="w">args</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Open should (perhaps indirectly) call <code class="inline"><span class="i">PerlIO_allocate</span><span class="s">(</span><span class="s">)</span></code>
 to allocate
a slot in the table and associate it with the layers information for
the opened file, by calling <code class="inline"><span class="w">PerlIO_push</span></code>
.  The <i>layers</i> is an
array of all the layers destined for the <code class="inline"><span class="w">PerlIO</span> *</code>
, and any
arguments passed to them, <i>n</i> is the index into that array of the
layer being called. The macro <code class="inline"><span class="w">PerlIOArg</span></code>
 will return a (possibly
<code class="inline"><span class="w">NULL</span></code>
) SV * for the argument passed to the layer.</p>
<p>The <i>mode</i> string is an "<code class="inline"><span class="i">fopen</span><span class="s">(</span><span class="s">)</span></code>
-like" string which would match
the regular expression <code class="inline"><span class="q">/^[I#]?[rwa]\+?[bt]?$/</span></code>
.</p>
<p>The <code class="inline"><span class="q">&#39;I&#39;</span></code>
 prefix is used during creation of <code class="inline"><span class="w">stdin</span></code>
..<code class="inline"><span class="w">stderr</span></code>
 via
special <code class="inline"><span class="w">PerlIO_fdopen</span></code>
 calls; the <code class="inline"><span class="q">&#39;#&#39;</span></code>
 prefix means that this is
<code class="inline"><a class="l_k" href="functions/sysopen.html">sysopen</a></code> and that <i>imode</i> and <i>perm</i> should be passed to
<code class="inline"><span class="w">PerlLIO_open3</span></code>
; <code class="inline"><span class="q">&#39;r&#39;</span></code>
 means <strong>r</strong>ead, <code class="inline"><span class="q">&#39;w&#39;</span></code>
 means <strong>w</strong>rite and
<code class="inline"><span class="q">&#39;a&#39;</span></code>
 means <strong>a</strong>ppend. The <code class="inline"><span class="q">&#39;+&#39;</span></code>
 suffix means that both reading and
writing/appending are permitted.  The <code class="inline"><span class="q">&#39;b&#39;</span></code>
 suffix means file should
be binary, and <code class="inline"><span class="q">&#39;t&#39;</span></code>
 means it is text. (Almost all layers should do
the IO in binary mode, and ignore the b/t bits. The <code class="inline"><span class="j">:</span><span class="w">crlf</span></code>
 layer
should be pushed to handle the distinction.)</p>
<p>If <i>old</i> is not <code class="inline"><span class="w">NULL</span></code>
 then this is a <code class="inline"><span class="w">PerlIO_reopen</span></code>
. Perl itself
does not use this (yet?) and semantics are a little vague.</p>
<p>If <i>fd</i> not negative then it is the numeric file descriptor <i>fd</i>,
which will be open in a manner compatible with the supplied mode
string, the call is thus equivalent to <code class="inline"><span class="w">PerlIO_fdopen</span></code>
. In this case
<i>nargs</i> will be zero.</p>
<p>If <i>nargs</i> is greater than zero then it gives the number of arguments
passed to <code class="inline"><a class="l_k" href="functions/open.html">open</a></code>, otherwise it will be 1 if for example
<code class="inline"><span class="w">PerlIO_open</span></code>
 was called.  In simple cases SvPV_nolen(*args) is the
pathname to open.</p>
<p>If a layer provides <code class="inline"><span class="i">Open</span><span class="s">(</span><span class="s">)</span></code>
 it should normally call the <code class="inline"><span class="i">Open</span><span class="s">(</span><span class="s">)</span></code>

method of next layer down (if any) and then push itself on top if that
succeeds.  <code class="inline"><span class="w">PerlIOBase_open</span></code>
 is provided to do exactly that, so in
most cases you don't have to write your own <code class="inline"><span class="i">Open</span><span class="s">(</span><span class="s">)</span></code>
 method.  If this
method is not defined, other layers may have difficulty pushing
themselves on top of it during open.</p>
<p>If <code class="inline"><span class="w">PerlIO_push</span></code>
 was performed and open has failed, it must
<code class="inline"><span class="w">PerlIO_pop</span></code>
 itself, since if it's not, the layer won't be removed
and may cause bad problems.</p>
<p>Returns <code class="inline"><span class="w">NULL</span></code>
 on failure.</p>
</li>
<li><a class='view-title' id="Binmode"></a><strong>Binmode</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>        <span class="s">(</span><span class="i">*Binmode</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Optional. Used when <code class="inline"><span class="j">:</span><span class="w">raw</span></code>
 layer is pushed (explicitly or as a result
of binmode(FH)). If not present layer will be popped. If present
should configure layer as binary (or pop itself) and return 0.
If it returns -1 for error <code class="inline"><a class="l_k" href="functions/binmode.html">binmode</a></code> will fail with layer
still on the stack.</p>
</li>
<li><a class='view-title' id="Getarg"></a><strong>Getarg</strong>
<pre class="verbatim"><ol><li>	<span class="w">SV</span> *      <span class="s">(</span><span class="i">*Getarg</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span></li><li>			    <span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Optional. If present should return an SV * representing the string
argument passed to the layer when it was
pushed. e.g. ":encoding(ascii)" would return an SvPV with value
"ascii". (<i>param</i> and <i>flags</i> arguments can be ignored in most
cases)</p>
<p><code class="inline"><span class="w">Dup</span></code>
 uses <code class="inline"><span class="w">Getarg</span></code>
 to retrieve the argument originally passed to
<code class="inline"><span class="w">Pushed</span></code>
, so you must implement this function if your layer has an
extra argument to <code class="inline"><span class="w">Pushed</span></code>
 and will ever be <code class="inline"><span class="w">Dup</span></code>
ed.</p>
</li>
<li><a class='view-title' id="Fileno"></a><strong>Fileno</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>        <span class="s">(</span><span class="i">*Fileno</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Returns the Unix/Posix numeric file descriptor for the handle. Normally
<code class="inline"><span class="i">PerlIOBase_fileno</span><span class="s">(</span><span class="s">)</span></code>
 (which just asks next layer down) will suffice
for this.</p>
<p>Returns -1 on error, which is considered to include the case where the
layer cannot provide such a file descriptor.</p>
</li>
<li><a class='view-title' id="Dup"></a><strong>Dup</strong>
<pre class="verbatim"><ol><li>	<span class="w">PerlIO</span> * <span class="s">(</span><span class="i">*Dup</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">PerlIO</span> *<span class="w">o</span><span class="cm">,</span></li><li>			<span class="w">CLONE_PARAMS</span> *<span class="w">param</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">flags</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>XXX: Needs more docs.</p>
<p>Used as part of the "clone" process when a thread is spawned (in which
case param will be non-NULL) and when a stream is being duplicated via
'&amp;' in the <code class="inline"><a class="l_k" href="functions/open.html">open</a></code>.</p>
<p>Similar to <code class="inline"><span class="w">Open</span></code>
, returns PerlIO* on success, <code class="inline"><span class="w">NULL</span></code>
 on failure.</p>
</li>
<li><a class='view-title' id="Read"></a><strong>Read</strong>
<pre class="verbatim"><ol><li>	<span class="w">SSize_t</span>	<span class="s">(</span><span class="i">*Read</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">void</span> *<span class="w">vbuf</span><span class="cm">,</span> <span class="w">Size_t</span> <span class="w">count</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Basic read operation.</p>
<p>Typically will call <code class="inline"><span class="w">Fill</span></code>
 and manipulate pointers (possibly via the
API).  <code class="inline"><span class="i">PerlIOBuf_read</span><span class="s">(</span><span class="s">)</span></code>
 may be suitable for derived classes which
provide "fast gets" methods.</p>
<p>Returns actual bytes read, or -1 on an error.</p>
</li>
<li><a class='view-title' id="Unread"></a><strong>Unread</strong>
<pre class="verbatim"><ol><li>	<span class="w">SSize_t</span>	<span class="s">(</span><span class="i">*Unread</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span></li><li>			  <span class="w">const</span> <span class="w">void</span> *<span class="w">vbuf</span><span class="cm">,</span> <span class="w">Size_t</span> <span class="w">count</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>A superset of stdio's <code class="inline"><span class="i">ungetc</span><span class="s">(</span><span class="s">)</span></code>
. Should arrange for future reads to
see the bytes in <code class="inline"><span class="w">vbuf</span></code>
. If there is no obviously better implementation
then <code class="inline"><span class="i">PerlIOBase_unread</span><span class="s">(</span><span class="s">)</span></code>
 provides the function by pushing a "fake"
"pending" layer above the calling layer.</p>
<p>Returns the number of unread chars.</p>
</li>
<li><a class='view-title' id="Write"></a><strong>Write</strong>
<pre class="verbatim"><ol><li>	<span class="w">SSize_t</span>	<span class="s">(</span><span class="i">*Write</span><span class="s">)</span><span class="s">(</span><span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">const</span> <span class="w">void</span> *<span class="w">vbuf</span><span class="cm">,</span> <span class="w">Size_t</span> <span class="w">count</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Basic write operation.</p>
<p>Returns bytes written or -1 on an error.</p>
</li>
<li><a class='view-title' id="Seek"></a><strong>Seek</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Seek</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span> <span class="w">Off_t</span> <span class="w">offset</span><span class="cm">,</span> <a class="l_k" href="functions/int.html">int</a> <span class="w">whence</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Position the file pointer. Should normally call its own <code class="inline"><span class="w">Flush</span></code>

method and then the <code class="inline"><span class="w">Seek</span></code>
 method of next layer down.</p>
<p>Returns 0 on success, -1 on failure.</p>
</li>
<li><a class='view-title' id="Tell"></a><strong>Tell</strong>
<pre class="verbatim"><ol><li>	<span class="w">Off_t</span>	<span class="s">(</span><span class="i">*Tell</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return the file pointer. May be based on layers cached concept of
position to avoid overhead.</p>
<p>Returns -1 on failure to get the file pointer.</p>
</li>
<li><a class='view-title' id="Close"></a><strong>Close</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Close</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Close the stream. Should normally call <code class="inline"><span class="i">PerlIOBase_close</span><span class="s">(</span><span class="s">)</span></code>
 to flush
itself and close layers below, and then deallocate any data structures
(buffers, translation tables, ...) not  held directly in the data
structure.</p>
<p>Returns 0 on success, -1 on failure.</p>
</li>
<li><a class='view-title' id="Flush"></a><strong>Flush</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Flush</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Should make stream's state consistent with layers below. That is, any
buffered write data should be written, and file position of lower layers
adjusted for data read from below but not actually consumed.
(Should perhaps <code class="inline"><span class="i">Unread</span><span class="s">(</span><span class="s">)</span></code>
 such data to the lower layer.)</p>
<p>Returns 0 on success, -1 on failure.</p>
</li>
<li><a class='view-title' id="Fill"></a><strong>Fill</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Fill</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>The buffer for this layer should be filled (for read) from layer
below.  When you "subclass" PerlIOBuf layer, you want to use its
<i>_read</i> method and to supply your own fill method, which fills the
PerlIOBuf's buffer.</p>
<p>Returns 0 on success, -1 on failure.</p>
</li>
<li><a class='view-title' id="Eof"></a><strong>Eof</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Eof</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return end-of-file indicator. <code class="inline"><span class="i">PerlIOBase_eof</span><span class="s">(</span><span class="s">)</span></code>
 is normally sufficient.</p>
<p>Returns 0 on end-of-file, 1 if not end-of-file, -1 on error.</p>
</li>
<li><a class='view-title' id="Error"></a><strong>Error</strong>
<pre class="verbatim"><ol><li>	<span class="w">IV</span>	<span class="s">(</span><span class="i">*Error</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return error indicator. <code class="inline"><span class="i">PerlIOBase_error</span><span class="s">(</span><span class="s">)</span></code>
 is normally sufficient.</p>
<p>Returns 1 if there is an error (usually when <code class="inline"><span class="w">PERLIO_F_ERROR</span></code>
 is set,
0 otherwise.</p>
</li>
<li><a class='view-title' id="Clearerr"></a><strong>Clearerr</strong>
<pre class="verbatim"><ol><li>	<span class="w">void</span>	<span class="s">(</span><span class="i">*Clearerr</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Clear end-of-file and error indicators. Should call <code class="inline"><span class="i">PerlIOBase_clearerr</span><span class="s">(</span><span class="s">)</span></code>

to set the <code class="inline"><span class="w">PERLIO_F_XXXXX</span></code>
 flags, which may suffice.</p>
</li>
<li><a class='view-title' id="Setlinebuf"></a><strong>Setlinebuf</strong>
<pre class="verbatim"><ol><li>	<span class="w">void</span>	<span class="s">(</span><span class="i">*Setlinebuf</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Mark the stream as line buffered. <code class="inline"><span class="i">PerlIOBase_setlinebuf</span><span class="s">(</span><span class="s">)</span></code>
 sets the
PERLIO_F_LINEBUF flag and is normally sufficient.</p>
</li>
<li><a class='view-title' id="Get_base"></a><strong>Get_base</strong>
<pre class="verbatim"><ol><li>	<span class="w">STDCHAR</span> *	<span class="s">(</span><span class="i">*Get_base</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Allocate (if not already done so) the read buffer for this layer and
return pointer to it. Return NULL on failure.</p>
</li>
<li><a class='view-title' id="Get_bufsiz"></a><strong>Get_bufsiz</strong>
<pre class="verbatim"><ol><li>	<span class="w">Size_t</span>	<span class="s">(</span><span class="i">*Get_bufsiz</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return the number of bytes that last <code class="inline"><span class="i">Fill</span><span class="s">(</span><span class="s">)</span></code>
 put in the buffer.</p>
</li>
<li><a class='view-title' id="Get_ptr"></a><strong>Get_ptr</strong>
<pre class="verbatim"><ol><li>	<span class="w">STDCHAR</span> *	<span class="s">(</span><span class="i">*Get_ptr</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return the current read pointer relative to this layer's buffer.</p>
</li>
<li><a class='view-title' id="Get_cnt"></a><strong>Get_cnt</strong>
<pre class="verbatim"><ol><li>	<span class="w">SSize_t</span>	<span class="s">(</span><span class="i">*Get_cnt</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Return the number of bytes left to be read in the current buffer.</p>
</li>
<li><a class='view-title' id="Set_ptrcnt"></a><strong>Set_ptrcnt</strong>
<pre class="verbatim"><ol><li>	<span class="w">void</span>	<span class="s">(</span><span class="i">*Set_ptrcnt</span><span class="s">)</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">PerlIO</span> *<span class="w">f</span><span class="cm">,</span></li><li>			      <span class="w">STDCHAR</span> *<span class="w">ptr</span><span class="cm">,</span> <span class="w">SSize_t</span> <span class="w">cnt</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Adjust the read pointer and count of bytes to match <code class="inline"><span class="w">ptr</span></code>
 and/or <code class="inline"><span class="w">cnt</span></code>
.
The application (or layer above) must ensure they are consistent.
(Checking is allowed by the paranoid.)</p>
</li>
</ul>
<a class='view-head2' id="Utilities"></a><h3 class='h3' >Utilities</h3>
<p>To ask for the next layer down use PerlIONext(PerlIO *f).</p>
<p>To check that a PerlIO* is valid use PerlIOValid(PerlIO *f).  (All
this does is really just to check that the pointer is non-NULL and
that the pointer behind that is non-NULL.)</p>
<p>PerlIOBase(PerlIO *f) returns the "Base" pointer, or in other words,
the <code class="inline"><span class="w">PerlIOl</span>*</code>
 pointer.</p>
<p>PerlIOSelf(PerlIO* f, type) return the PerlIOBase cast to a type.</p>
<p>Perl_PerlIO_or_Base(PerlIO* f, callback, base, failure, args) either
calls the <i>callback</i> from the functions of the layer <i>f</i> (just by
the name of the IO function, like "Read") with the <i>args</i>, or if
there is no such callback, calls the <i>base</i> version of the callback
with the same args, or if the f is invalid, set errno to EBADF and
return <i>failure</i>.</p>
<p>Perl_PerlIO_or_fail(PerlIO* f, callback, failure, args) either calls
the <i>callback</i> of the functions of the layer <i>f</i> with the <i>args</i>,
or if there is no such callback, set errno to EINVAL.  Or if the f is
invalid, set errno to EBADF and return <i>failure</i>.</p>
<p>Perl_PerlIO_or_Base_void(PerlIO* f, callback, base, args) either calls
the <i>callback</i> of the functions of the layer <i>f</i> with the <i>args</i>,
or if there is no such callback, calls the <i>base</i> version of the
callback with the same args, or if the f is invalid, set errno to
EBADF.</p>
<p>Perl_PerlIO_or_fail_void(PerlIO* f, callback, args) either calls the
<i>callback</i> of the functions of the layer <i>f</i> with the <i>args</i>, or if
there is no such callback, set errno to EINVAL.  Or if the f is
invalid, set errno to EBADF.</p>
<a class='view-head2' id="Implementing-PerlIO-Layers"></a><h3 class='h3' >Implementing PerlIO Layers</h3>
<p>If you find the implementation document unclear or not sufficient,
look at the existing PerlIO layer implementations, which include:</p>
<ul>
<li><a class='view-title' id="*-C-implementations"></a><strong>C implementations</strong>
<p>The <i>perlio.c</i> and <i>perliol.h</i> in the Perl core implement the
"unix", "perlio", "stdio", "crlf", "utf8", "byte", "raw", "pending"
layers, and also the "mmap" and "win32" layers if applicable.
(The "win32" is currently unfinished and unused, to see what is used
instead in Win32, see <a href="PerlIO.html#Querying-the-layers-of-filehandles">Querying the layers of filehandles in PerlIO</a> .)</p>
<p>PerlIO::encoding, PerlIO::scalar, PerlIO::via in the Perl core.</p>
<p>PerlIO::gzip and APR::PerlIO (mod_perl 2.0) on CPAN.</p>
</li>
<li><a class='view-title' id="*-Perl-implementations"></a><strong>Perl implementations</strong>
<p>PerlIO::via::QuotedPrint in the Perl core and PerlIO::via::* on CPAN.</p>
</li>
</ul>
<p>If you are creating a PerlIO layer, you may want to be lazy, in other
words, implement only the methods that interest you.  The other methods
you can either replace with the "blank" methods</p>
<pre class="verbatim"><ol><li>    <span class="w">PerlIOBase_noop_ok</span></li><li>    <span class="w">PerlIOBase_noop_fail</span></li></ol></pre><p>(which do nothing, and return zero and -1, respectively) or for
certain methods you may assume a default behaviour by using a NULL
method.  The Open method looks for help in the 'parent' layer.
The following table summarizes the behaviour:</p>
<pre class="verbatim"><ol><li>    <span class="w">method</span>      <span class="w">behaviour</span> <span class="w">with</span> <span class="w">NULL</span></li><li></li><li>    <span class="w">Clearerr</span>    <span class="w">PerlIOBase_clearerr</span></li><li>    <span class="w">Close</span>       <span class="w">PerlIOBase_close</span></li><li>    <span class="w">Dup</span>         <span class="w">PerlIOBase_dup</span></li><li>    <span class="w">Eof</span>         <span class="w">PerlIOBase_eof</span></li><li>    <span class="w">Error</span>       <span class="w">PerlIOBase_error</span></li><li>    <span class="w">Fileno</span>      <span class="w">PerlIOBase_fileno</span></li><li>    <span class="w">Fill</span>        <span class="w">FAILURE</span></li><li>    <span class="w">Flush</span>       <span class="w">SUCCESS</span></li><li>    <span class="w">Getarg</span>      <span class="w">SUCCESS</span></li><li>    <span class="w">Get_base</span>    <span class="w">FAILURE</span></li><li>    <span class="w">Get_bufsiz</span>  <span class="w">FAILURE</span></li><li>    <span class="w">Get_cnt</span>     <span class="w">FAILURE</span></li><li>    <span class="w">Get_ptr</span>     <span class="w">FAILURE</span></li><li>    <span class="w">Open</span>        <span class="w">INHERITED</span></li><li>    <span class="w">Popped</span>      <span class="w">SUCCESS</span></li><li>    <span class="w">Pushed</span>      <span class="w">SUCCESS</span></li><li>    <span class="w">Read</span>        <span class="w">PerlIOBase_read</span></li><li>    <span class="w">Seek</span>        <span class="w">FAILURE</span></li><li>    <span class="w">Set_cnt</span>     <span class="w">FAILURE</span></li><li>    <span class="w">Set_ptrcnt</span>  <span class="w">FAILURE</span></li><li>    <span class="w">Setlinebuf</span>  <span class="w">PerlIOBase_setlinebuf</span></li><li>    <span class="w">Tell</span>        <span class="w">FAILURE</span></li><li>    <span class="w">Unread</span>      <span class="w">PerlIOBase_unread</span></li><li>    <span class="w">Write</span>       <span class="w">FAILURE</span></li><li></li><li> <span class="w">FAILURE</span>        <span class="w">Set</span> <span class="w">errno</span> <span class="s">(</span><span class="w">to</span> <span class="w">EINVAL</span> <span class="w">in</span> <span class="w">Unixish</span><span class="cm">,</span> <span class="w">to</span> <span class="w">LIB</span><span class="i">$_INVARG</span> <span class="w">in</span> <span class="w">VMS</span><span class="s">)</span> <a class="l_k" href="functions/and.html">and</a></li><li>                <a class="l_k" href="functions/return.html">return</a> <span class="n">-1</span> <span class="s">(</span><a class="l_k" href="functions/for.html">for</a> <span class="w">numeric</span> <a class="l_k" href="functions/return.html">return</a> <a class="l_k" href="functions/values.html">values</a><span class="s">)</span> <a class="l_k" href="functions/or.html">or</a> <span class="w">NULL</span> <span class="s">(</span><a class="l_k" href="functions/for.html">for</a> <span class="w">pointers</span><span class="s">)</span></li><li> <span class="w">INHERITED</span>      <span class="w">Inherited</span> <span class="w">from</span> <span class="w">the</span> <span class="w">layer</span> <span class="w">below</span></li><li> <span class="w">SUCCESS</span>        <span class="w">Return</span> <span class="n">0</span> <span class="s">(</span><a class="l_k" href="functions/for.html">for</a> <span class="w">numeric</span> <a class="l_k" href="functions/return.html">return</a> <a class="l_k" href="functions/values.html">values</a><span class="s">)</span> <a class="l_k" href="functions/or.html">or</a> <span class="w">a</span> <span class="w">pointer</span></li></ol></pre><a class='view-head2' id="Core-Layers"></a><h3 class='h3' >Core Layers</h3>
<p>The file <code class="inline"><span class="w">perlio</span>.<span class="w">c</span></code>
 provides the following layers:</p>
<ul>
<li><a class='view-title' id="%22unix%22"></a><strong>"unix"</strong>
<p>A basic non-buffered layer which calls Unix/POSIX <code class="inline"><a class="l_k" href="functions/read.html">read()</a></code>, <code class="inline"><a class="l_k" href="functions/write.html">write()</a></code>,
<code class="inline"><span class="i">lseek</span><span class="s">(</span><span class="s">)</span></code>
, <code class="inline"><a class="l_k" href="functions/close.html">close()</a></code>. No buffering. Even on platforms that distinguish
between O_TEXT and O_BINARY this layer is always O_BINARY.</p>
</li>
<li><a class='view-title' id="%22perlio%22"></a><strong>"perlio"</strong>
<p>A very complete generic buffering layer which provides the whole of
PerlIO API. It is also intended to be used as a "base class" for other
layers. (For example its <code class="inline"><span class="i">Read</span><span class="s">(</span><span class="s">)</span></code>
 method is implemented in terms of
the <code class="inline"><span class="i">Get_cnt</span><span class="s">(</span><span class="s">)</span></code>
/<code class="inline"><span class="i">Get_ptr</span><span class="s">(</span><span class="s">)</span></code>
/<code class="inline"><span class="i">Set_ptrcnt</span><span class="s">(</span><span class="s">)</span></code>
 methods).</p>
<p>"perlio" over "unix" provides a complete replacement for stdio as seen
via PerlIO API. This is the default for USE_PERLIO when system's stdio
does not permit perl's "fast gets" access, and which do not
distinguish between <code class="inline"><span class="w">O_TEXT</span></code>
 and <code class="inline"><span class="w">O_BINARY</span></code>
.</p>
</li>
<li><a class='view-title' id="%22stdio%22"></a><strong>"stdio"</strong>
<p>A layer which provides the PerlIO API via the layer scheme, but
implements it by calling system's stdio. This is (currently) the default
if system's stdio provides sufficient access to allow perl's "fast gets"
access and which do not distinguish between <code class="inline"><span class="w">O_TEXT</span></code>
 and <code class="inline"><span class="w">O_BINARY</span></code>
.</p>
</li>
<li><a class='view-title' id="%22crlf%22"></a><strong>"crlf"</strong>
<p>A layer derived using "perlio" as a base class. It provides Win32-like
"\n" to CR,LF translation. Can either be applied above "perlio" or serve
as the buffer layer itself. "crlf" over "unix" is the default if system
distinguishes between <code class="inline"><span class="w">O_TEXT</span></code>
 and <code class="inline"><span class="w">O_BINARY</span></code>
 opens. (At some point
"unix" will be replaced by a "native" Win32 IO layer on that platform,
as Win32's read/write layer has various drawbacks.) The "crlf" layer is
a reasonable model for a layer which transforms data in some way.</p>
</li>
<li><a class='view-title' id="%22mmap%22"></a><strong>"mmap"</strong>
<p>If Configure detects <code class="inline"><span class="i">mmap</span><span class="s">(</span><span class="s">)</span></code>
 functions this layer is provided (with
"perlio" as a "base") which does "read" operations by mmap()ing the
file. Performance improvement is marginal on modern systems, so it is
mainly there as a proof of concept. It is likely to be unbundled from
the core at some point. The "mmap" layer is a reasonable model for a
minimalist "derived" layer.</p>
</li>
<li><a class='view-title' id="%22pending%22"></a><strong>"pending"</strong>
<p>An "internal" derivative of "perlio" which can be used to provide
Unread() function for layers which have no buffer or cannot be
bothered.  (Basically this layer's <code class="inline"><span class="i">Fill</span><span class="s">(</span><span class="s">)</span></code>
 pops itself off the stack
and so resumes reading from layer below.)</p>
</li>
<li><a class='view-title' id="%22raw%22"></a><strong>"raw"</strong>
<p>A dummy layer which never exists on the layer stack. Instead when
"pushed" it actually pops the stack removing itself, it then calls
Binmode function table entry on all the layers in the stack - normally
this (via PerlIOBase_binmode) removes any layers which do not have
<code class="inline"><span class="w">PERLIO_K_RAW</span></code>
 bit set. Layers can modify that behaviour by defining
their own Binmode entry.</p>
</li>
<li><a class='view-title' id="%22utf8%22"></a><strong>"utf8"</strong>
<p>Another dummy layer. When pushed it pops itself and sets the
<code class="inline"><span class="w">PERLIO_F_UTF8</span></code>
 flag on the layer which was (and now is once more)
the top of the stack.</p>
</li>
</ul>
<p>In addition <i>perlio.c</i> also provides a number of <code class="inline"><span class="i">PerlIOBase_xxxx</span><span class="s">(</span><span class="s">)</span></code>

functions which are intended to be used in the table slots of classes
which do not need to do anything special for a particular method.</p>
<a class='view-head2' id="Extension-Layers"></a><h3 class='h3' >Extension Layers</h3>
<p>Layers can be made available by extension modules. When an unknown layer
is encountered the PerlIO code will perform the equivalent of :</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/use.html">use</a> <span class="w">PerlIO</span> <span class="q">&#39;layer&#39;</span><span class="sc">;</span></li></ol></pre><p>Where <i>layer</i> is the unknown layer. <i>PerlIO.pm</i> will then attempt to:</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/require.html">require</a> <span class="w">PerlIO::layer</span><span class="sc">;</span></li></ol></pre><p>If after that process the layer is still not defined then the <code class="inline"><a class="l_k" href="functions/open.html">open</a></code>
will fail.</p>
<p>The following extension layers are bundled with perl:</p>
<ul>
<li><a class='view-title' id="%22%3aencoding%22"></a><strong>":encoding"</strong>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/use.html">use</a> <span class="w">Encoding</span><span class="sc">;</span></li></ol></pre><p>makes this layer available, although <i>PerlIO.pm</i> "knows" where to
find it.  It is an example of a layer which takes an argument as it is
called thus:</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/open.html">open</a><span class="s">(</span> <span class="i">$fh</span><span class="cm">,</span> <span class="q">&quot;&lt;:encoding(iso-8859-7)&quot;</span><span class="cm">,</span> <span class="i">$pathname</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a class='view-title' id="%22%3ascalar%22"></a><strong>":scalar"</strong>
<p>Provides support for reading data from and writing data to a scalar.</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/open.html">open</a><span class="s">(</span> <span class="i">$fh</span><span class="cm">,</span> <span class="q">&quot;+&lt;:scalar&quot;</span><span class="cm">,</span> \<span class="i">$scalar</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>When a handle is so opened, then reads get bytes from the string value
of <i>$scalar</i>, and writes change the value. In both cases the position
in <i>$scalar</i> starts as zero but can be altered via <code class="inline"><a class="l_k" href="functions/seek.html">seek</a></code>, and
determined via <code class="inline"><a class="l_k" href="functions/tell.html">tell</a></code>.</p>
<p>Please note that this layer is implied when calling open() thus:</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/open.html">open</a><span class="s">(</span> <span class="i">$fh</span><span class="cm">,</span> <span class="q">&quot;+&lt;&quot;</span><span class="cm">,</span> \<span class="i">$scalar</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre></li>
<li><a class='view-title' id="%22%3avia%22"></a><strong>":via"</strong>
<p>Provided to allow layers to be implemented as Perl code.  For instance:</p>
<pre class="verbatim"><ol><li>   <a class="l_k" href="functions/use.html">use</a> <span class="w">PerlIO::via::StripHTML</span><span class="sc">;</span></li><li>   <a class="l_k" href="functions/open.html">open</a><span class="s">(</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$fh</span><span class="cm">,</span> <span class="q">&quot;&lt;:via(StripHTML)&quot;</span><span class="cm">,</span> <span class="q">&quot;index.html&quot;</span> <span class="s">)</span><span class="sc">;</span></li></ol></pre><p>See <a href="PerlIO/via.html">PerlIO::via</a> for details.</p>
</li>
</ul>
<a class='view-head1' id="TODO"></a><h2 class='h2' >TODO</h2>
<p>Things that need to be done to improve this document.</p>
<ul>
<li>
<p>Explain how to make a valid fh without going through open()(i.e. apply
a layer). For example if the file is not opened through perl, but we
want to get back a fh, like it was opened by Perl.</p>
<p>How PerlIO_apply_layera fits in, where its docs, was it made public?</p>
<p>Currently the example could be something like this:</p>
<pre class="verbatim"><ol><li>  <span class="w">PerlIO</span> *<span class="i">foo_to_PerlIO</span><span class="s">(</span><span class="w">pTHX_</span> <span class="w">char</span> *<span class="w">mode</span><span class="cm">,</span> ...<span class="s">)</span></li><li>  <span class="s">{</span></li><li>      <span class="w">char</span> *<span class="w">mode</span><span class="sc">;</span> <span class="q">/* &quot;w&quot;, &quot;r&quot;, etc */</span></li><li>      <span class="w">const</span> <span class="w">char</span> *<span class="w">layers</span> = <span class="q">&quot;:APR&quot;</span><span class="sc">;</span> <span class="q">/* the layer name */</span></li><li>      <span class="w">PerlIO</span> *<span class="w">f</span> = <span class="i">PerlIO_allocate</span><span class="s">(</span><span class="w">aTHX</span><span class="s">)</span><span class="sc">;</span></li><li>      <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span>!<span class="w">f</span><span class="s">)</span> <span class="s">{</span></li><li>          <a class="l_k" href="functions/return.html">return</a> <span class="w">NULL</span><span class="sc">;</span></li><li>      <span class="s">}</span></li><li></li><li>      <span class="i">PerlIO_apply_layers</span><span class="s">(</span><span class="w">aTHX_</span> <span class="w">f</span><span class="cm">,</span> <span class="w">mode</span><span class="cm">,</span> <span class="w">layers</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>      <a class="l_k" href="functions/if.html">if</a> <span class="s">(</span><span class="w">f</span><span class="s">)</span> <span class="s">{</span></li><li>          <span class="w">PerlIOAPR</span> *<span class="w">st</span> = <span class="i">PerlIOSelf</span><span class="s">(</span><span class="w">f</span><span class="cm">,</span> <span class="w">PerlIOAPR</span><span class="s">)</span><span class="sc">;</span></li><li>          <span class="q">/* fill in the st struct, as in _open() */</span></li><li>          <span class="w">st</span><span class="w">-&gt;file</span> = <span class="w">file</span><span class="sc">;</span></li><li>          <span class="i">PerlIOBase</span><span class="s">(</span><span class="w">f</span><span class="s">)</span><span class="i">-&gt;flags</span> |= <span class="w">PERLIO_F_OPEN</span><span class="sc">;</span></li><li></li><li>          <a class="l_k" href="functions/return.html">return</a> <span class="w">f</span><span class="sc">;</span></li><li>      <span class="s">}</span></li><li>      <a class="l_k" href="functions/return.html">return</a> <span class="w">NULL</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre></li>
<li>
<p>fix/add the documentation in places marked as XXX.</p>
</li>
<li>
<p>The handling of errors by the layer is not specified. e.g. when $!
should be set explicitly, when the error handling should be just
delegated to the top layer.</p>
<p>Probably give some hints on using SETERRNO() or pointers to where they
can be found.</p>
</li>
<li>
<p>I think it would help to give some concrete examples to make it easier
to understand the API. Of course I agree that the API has to be
concise, but since there is no second document that is more of a
guide, I think that it'd make it easier to start with the doc which is
an API, but has examples in it in places where things are unclear, to
a person who is not a PerlIO guru (yet).</p>
</li>
</ul>




      <ul><li><a href="#NAME">NAME</a></li><li><a href="#SYNOPSIS">SYNOPSIS</a></li><li><a href="#DESCRIPTION">DESCRIPTION</a></li><ul><li><a href="#History-and-Background">History and Background</a></li><li><a href="#Basic-Structure">Basic Structure</a></li><li><a href="#Layers-vs-Disciplines">Layers vs Disciplines</a></li><li><a href="#Data-Structures">Data Structures</a></li><li><a href="#Functions-and-Attributes">Functions and Attributes</a></li><li><a href="#Per-instance-Data">Per-instance Data</a></li><li><a href="#Layers-in-action.">Layers in action.</a></li><li><a href="#Per-instance-flag-bits">Per-instance flag bits</a></li><li><a href="#Methods-in-Detail">Methods in Detail</a></li><li><a href="#Utilities">Utilities</a></li><li><a href="#Implementing-PerlIO-Layers">Implementing PerlIO Layers</a></li><li><a href="#Core-Layers">Core Layers</a></li><li><a href="#Extension-Layers">Extension Layers</a></li></ul><li><a href="#TODO">TODO</a></li></ul>


                  </div>
                </article>
              </div>
            </div>
          </main>
        </div>
           <footer class="footer row bg-light pt-5 pb-5">
       <div class="col-sm-10 offset-sm-1 col-xl-8 offset-xl-2">
           <div class="row">
               <div class="col-md-4">
                   <ul class="list-unstyled">
                       <li>
                           <h4>Site info</h4>
                       </li>
                       <li>Docs mantained by
                           <a href="//lists.perl.org/list/perl5-porters.html"
                               rel="noopener">Perl 5 Porters</a>
                       </li>
                       <li>Perldoc site development sponsored by
                           <a href="//opusvl.com" rel="noopener">
                           <img style="margin: 20px 20px 5px 10px" class="opus-logo" src="/public/img/opusvl_logo.svg" alt="OpusVL Logo">
                        </a>
                    <li><span class="about_perldoc"><a href="//about.html">About PerlDOC</a></span>
                    </li>
                       </li>
                   </ul>
               </div>
               <div class="col-md-8">
                   <div class="row">
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Manuals</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-overview.html">Overview</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-tutorials.html">Tutorials</a>
                               </li>
                               <li>
                                   <a href="/5.16.2/index-faq.html">FAQs</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-history.html">Changes</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Reference</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-language.html">Language</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-functions.html">Functions</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/perlop.html">Operators</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/perlvar.html">Variables</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Modules</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-modules-A.html">Modules</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-pragmas.html">Pragmas</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-utilities.html">Utilities</a>
                               </li>
                           </ul>
                       </div>
                       <div class="col-md-6 col-lg-3">
                           <ul class=" list-unstyled">
                               <li>
                                   <h4>Misc</h4>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-licence.html">License</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-internals.html">Internals</a>
                               </li>
                               <li>
                                   <a
                                       href="/5.16.2/index-platforms.html">Platforms</a>
                               </li>
                            <li>
                                <a
                                    href="/5.16.2/index-about.html">About</a>
                            </li>
                           </ul>
                       </div>
                   </div>
               </div>
               <div class=" col-12 footer-inf text-center">
                   <small>perldoc.perl.org - Official documentation for the Perl
                       programming language</small>
               </div>
           </div>
       </div>
   </footer>

        	<div class="beta-wrapper beta-bottom-right ">
		<div class="beta beta-blue  ">
			<a class="beta-link "
				href="//github.com/OpusVL/perldoc.perl.org/issues/new" rel="noopener">
				<span class="beta-text">
					This website is a Beta release.
				</span>
				<span class="beta-text">
					For any issues please raise a ticket on GitHub
				</span>
			</a>
		</div>
	</div>

        <script src="/public/js/main.min.js"></script>
      </body>

      </html>
